import{r as l,u as At,C as q,M as Pt,V as ue,i as K,j as Nt,Q as et,k as Tt,S as jt,B as tt,l as Vt,R as Gt,m as Oe,n as Ft,K as Ee,o as $,p as nt,q as ot,s as z,t as Bt,v as Ut,w as J,x as de,y as W,H as Me,E as rt,z as Se,D as ne,A as se,F as Te,G as Ht,I as Yt,L as Wt,P as Kt,J as Xt,N as $t,O as Zt,T as st,U as qt,W as Qt,X as Jt,Y as Ie,Z as en,$ as ye,a0 as tn,a1 as ke,a2 as Le,a3 as it,a4 as ct,a5 as at,a6 as nn,a7 as lt,a8 as on,a9 as rn,aa as sn,ab as ut,ac as cn,ad as an,ae as ln,af as un,ag as dn,ah as fn,ai as pn,aj as gn}from"./vendor-Cwl-XID1.js";var vn={VITE_API_LOCAL_URL:"http://localhost:3000/api/v1/",VITE_API_URL:"https://api-develop.bonuts.ru/api/v1/",BASE_URL:"/",MODE:"staging",DEV:!1,PROD:!0,SSR:!1};const je=e=>{let n;const t=new Set,o=(h,m)=>{const v=typeof h=="function"?h(n):h;if(!Object.is(v,n)){const C=n;n=m??typeof v!="object"?v:Object.assign({},n,v),t.forEach(p=>p(n,C))}},s=()=>n,c={setState:o,getState:s,subscribe:h=>(t.add(h),()=>t.delete(h)),destroy:()=>{(vn?"staging":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),t.clear()}};return n=e(o,s,c),c},hn=e=>e?je(e):je;var mn={VITE_API_LOCAL_URL:"http://localhost:3000/api/v1/",VITE_API_URL:"https://api-develop.bonuts.ru/api/v1/",BASE_URL:"/",MODE:"staging",DEV:!1,PROD:!0,SSR:!1};const{useSyncExternalStoreWithSelector:yn}=At;function dt(e,n=e.getState,t){const o=yn(e.subscribe,e.getState,e.getServerState||e.getState,n,t);return l.useDebugValue(o),o}const Ve=e=>{(mn?"staging":void 0)!=="production"&&typeof e!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const n=typeof e=="function"?hn(e):e,t=(o,s)=>dt(n,o,s);return Object.assign(t,n),t},bn=e=>e?Ve(e):Ve;var xn={VITE_API_LOCAL_URL:"http://localhost:3000/api/v1/",VITE_API_URL:"https://api-develop.bonuts.ru/api/v1/",BASE_URL:"/",MODE:"staging",DEV:!1,PROD:!0,SSR:!1};function En(){(xn?"staging":void 0)!=="production"&&console.warn("[DEPRECATED] `context` will be removed in a future version. Instead use `import { createStore, useStore } from 'zustand'`. See: https://github.com/pmndrs/zustand/discussions/1180.");const e=l.createContext(void 0);return{Provider:({createStore:s,children:r})=>{const i=l.useRef();return i.current||(i.current=s()),l.createElement(e.Provider,{value:i.current},r)},useStore:(s,r)=>{const i=l.useContext(e);if(!i)throw new Error("Seems like you have not used zustand provider as an ancestor.");return dt(i,s,r)},useStoreApi:()=>{const s=l.useContext(e);if(!s)throw new Error("Seems like you have not used zustand provider as an ancestor.");return l.useMemo(()=>({...s}),[s])}}}(function(){try{if(typeof document<"u"){var e=document.createElement("style");e.appendChild(document.createTextNode(`._canvas_670zp_1 {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
}
._container_155l7_1 {
  transform-origin: bottom right;
  overflow: hidden;
  position: absolute;
  border: solid 1px var(--radial-menu-border);
}

  ._container_155l7_1._disabled_155l7_7 {
    opacity: 0.6;
  }

  ._container_155l7_1._disabled_155l7_7 ._contentContainer_155l7_10 {
      cursor: not-allowed;
    }

  ._container_155l7_1:not(._disabled_155l7_7) ._contentContainer_155l7_10 {
      cursor: pointer;
    }

  ._container_155l7_1:not(._disabled_155l7_7) ._contentContainer_155l7_10:hover {
        color: var(--radial-menu-active-color);
        background: var(--radial-menu-active-background);
      }

  ._container_155l7_1 ._contentContainer_155l7_10 {
    width: 200%;
    height: 200%;
    transform-origin: 50% 50%;
    border-radius: 50%;
    outline: none;
    transition: background 150ms ease-in-out;
    color: var(--radial-menu-color);
  }

  ._container_155l7_1 ._contentContainer_155l7_10 ._contentInner_155l7_35 {
      position: absolute;
      width: 100%;
      text-align: center;
    }

  ._container_155l7_1 ._contentContainer_155l7_10 ._contentInner_155l7_35 ._content_155l7_10 {
        display: inline-block;
      }

  ._container_155l7_1 svg {
    margin: 0 auto;
    fill: var(--radial-menu-active-color);
    height: 25px;
    width: 25px;
    display: block;
  }
._container_x9hyx_1 {
  border-radius: 50%;
  z-index: 9;
  position: relative;
  height: 175px;
  width: 175px;
  border: solid 5px var(--radial-menu-border);
  overflow: hidden;
  background: var(--radial-menu-background);
}

  ._container_x9hyx_1:before {
    content: ' ';
    background: var(--radial-menu-border);
    border-radius: 50%;
    height: 25px;
    width: 25px;
    position: absolute;
    z-index: 9;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
  }`)),document.head.appendChild(e)}}catch(n){console.error("vite-plugin-css-injected-by-js",n)}})();var Ge,Fe;function ft(e,n=[]){const t=n.length;for(const o of e){const s=n.indexOf(o);if(s>-1){const r=[...n.slice(s),o].map(i=>i.data.id);throw new Error(`Invalid Graph: Circular node path detected: ${r.join(" -> ")}.`)}t>o.depth&&(o.depth=t,ft(o.out,[...n,o]))}}function pt(e,n){let t=!1;const o=e.reduce((i,c)=>({...i,[c.id]:{data:c,out:[],depth:-1,ins:[]}}),{});try{for(const i of n){const c=i.source,h=i.target;if(!o.hasOwnProperty(c))throw new Error(`Missing source Node ${c}`);if(!o.hasOwnProperty(h))throw new Error(`Missing target Node ${h}`);const m=o[c],v=o[h];v.ins.push(m),m.out.push(v)}ft(Object.values(o))}catch{t=!0}const s=Object.keys(o).map(i=>o[i].depth),r=Math.max(...s);return{invalid:t,depths:o,maxDepth:r||1}}const Be=["radialin","radialout"];function Cn({nodes:e,edges:n,mode:t="lr",nodeLevelRatio:o=2}){const{depths:s,maxDepth:r,invalid:i}=pt(e,n);if(i)return null;const c=Be.includes(t)?1:5,h=e.length/r*o*c;if(t){const m=(x,b)=>u=>x?(s[u.id].depth-r/2)*h*(b?-1:1):void 0,v=m(["lr","rl"].includes(t),t==="rl"),C=m(["td","bu"].includes(t),t==="td"),p=m(["zin","zout"].includes(t),t==="zout");e.forEach(x=>{x.fx=v(x),x.fy=C(x),x.fz=p(x)})}return Be.includes(t)?dn(m=>{const v=s[m.id];return(t==="radialin"?r-v.depth:v.depth)*h}).strength(1):null}function _n(e){return new Promise((n,t)=>{let o;function s(){o?n(o):(o=e.step(),s())}s()})}function ge(e){const n=[],t=[];return e.forEachNode((o,s)=>{n.push({...s,id:o,radius:s.size||1})}),e.forEachEdge((o,s)=>{t.push({...s,id:o})}),{nodes:n,edges:t}}function wn(){const e=a=>()=>a;let t=a=>a.index,o=[],s=[],r,i=[100,100],c=e(1),h=e(-1),m=e(100),v=e(.1),C={},p=.1,x=.001,b=[],u=[0,0],f,d=a=>a.cluster,y="treemap",g=!0,S=.1;function E(a){if(!g)return E;y==="force"&&(f.tick(),G());for(let R=0,w=o.length,L,O=a*S;R<w;++R)L=o[R],L.vx+=(C[d(L)].x-L.x)*O,L.vy+=(C[d(L)].y-L.y)*O}function P(){o&&(y==="treemap"?k():j())}E.initialize=function(a){o=a,P()};function F(a){let R=d(a.source),w=d(a.target);return R<=w?R+"~"+w:w+"~"+R}function _(a){let R=new Map,w={};return a.forEach(function(L){R.has(d(L))||R.set(d(L),{count:0,sumforceNodeSize:0})}),a.forEach(function(L){w=R.get(d(L)),w.count=w.count+1,w.sumforceNodeSize=w.sumforceNodeSize+Math.PI*(c(L)*c(L))*1.3,R.set(d(L),w)}),R}function A(a){let R=new Map,w=[];return a.forEach(function(L){let O=F(L),V;R.has(O)?V=R.get(O):V=0,V+=1,R.set(O,V)}),R.forEach(function(L,O){let V,D;V=O.split("~")[0],D=O.split("~")[1],V!==void 0&&D!==void 0&&w.push({source:V,target:D,count:L})}),w}function N(){let a=[],R=[],w=new Map,L,O,V,D,X;D=_(o),X=A(s);for(L of D.keys())V=D.get(L),a.push({id:L,size:V.count,r:Math.sqrt(V.sumforceNodeSize/Math.PI)}),w.set(L,O);return X.forEach(function(Y){let te=w.get(Y.source),Q=w.get(Y.target);te!==void 0&&Q!==void 0&&R.push({source:te,target:Q,count:Y.count})}),{nodes:a,links:R}}function M(){let a=[],R,w,L;L=_(E.nodes());for(R of L.keys())w=L.get(R),a.push({id:R,size:w.count});return{id:"clustersTree",children:a}}function G(){return C.none={x:0,y:0},b.forEach(function(a){y==="treemap"?C[a.data.id]={x:a.x0+(a.x1-a.x0)/2-u[0],y:a.y0+(a.y1-a.y0)/2-u[1]}:C[a.id]={x:a.x-u[0],y:a.y-u[1]}}),C}function k(){let a=fn().size(E.size());r=ut(M()).sum(R=>R.radius).sort(function(R,w){return w.height-R.height||w.value-R.value}),b=a(r).leaves(),G()}function T(){let a=0;o.length!==0&&s.forEach(function(R){let w,L;if(o){if(w=R.source,L=R.target,typeof R.source!="object"&&(w=o.find(O=>O.id===R.source)),typeof R.target!="object"&&(L=o.find(O=>O.id===R.target)),w===void 0||L===void 0)throw Error("Error setting links, couldnt find nodes for a link (see it on the console)");R.source=w,R.target=L,R.index=a++}})}function j(){let a;!o||!o.length||(T(),a=N(),f=it(a.nodes).force("x",ke(i[0]/2).strength(.1)).force("y",Le(i[1]/2).strength(.1)).force("collide",lt(R=>R.r).iterations(4)).force("charge",at().strength(h)).force("links",ct(a.nodes.length?a.links:[]).distance(m).strength(v)),b=f.nodes(),G())}return E.template=function(a){return arguments.length?(y=a,P(),E):y},E.groupBy=function(a){return arguments.length?typeof a=="string"?(d=function(R){return R[a]},E):(d=a,E):d},E.enableGrouping=function(a){return arguments.length?(g=a,E):g},E.strength=function(a){return arguments.length?(S=a,E):S},E.getLinkStrength=function(a){return g?d(a.source)===d(a.target)?typeof p=="function"?p(a):p:typeof x=="function"?x(a):x:typeof p=="function"?p(a):p},E.id=function(a){return arguments.length?(t=a,E):t},E.size=function(a){return arguments.length?(i=a,E):i},E.linkStrengthInterCluster=function(a){return arguments.length?(x=a,E):x},E.linkStrengthIntraCluster=function(a){return arguments.length?(p=a,E):p},E.nodes=function(a){return arguments.length?(o=a,E):o},E.links=function(a){return arguments.length?(a===null?s=[]:s=a,P(),E):s},E.template=function(a){return arguments.length?(y=a,P(),E):y},E.forceNodeSize=function(a){return arguments.length?(c=typeof a=="function"?a:e(+a),P(),E):c},E.nodeSize=E.forceNodeSize,E.forceCharge=function(a){return arguments.length?(h=typeof a=="function"?a:e(+a),P(),E):h},E.forceLinkDistance=function(a){return arguments.length?(m=typeof a=="function"?a:e(+a),P(),E):m},E.forceLinkStrength=function(a){return arguments.length?(v=typeof a=="function"?a:e(+a),P(),E):v},E.offset=function(a){return arguments.length?(u=typeof a=="function"?a:e(+a),E):u},E.getFocis=G,E}function re({graph:e,nodeLevelRatio:n=2,mode:t=null,dimensions:o=2,nodeStrength:s=-250,linkDistance:r=50,clusterStrength:i=.5,linkStrengthInterCluster:c=.01,linkStrengthIntraCluster:h=.5,forceLinkDistance:m=100,forceLinkStrength:v=.1,clusterType:C="force",forceCharge:p=-700,getNodePosition:x,drags:b,clusterAttribute:u,forceLayout:f}){const{nodes:d,edges:y}=ge(e),S=o===2&&y.length>25?s*2:s;let E,P;f==="forceDirected2d"?(E=ke(),P=Le()):(E=ke(600).strength(.05),P=Le(600).strength(.05));const F=it().force("link",ct()).force("charge",at().strength(S)).force("x",E).force("y",P).force("z",nn()).force("collide",lt(M=>M.radius+10)).force("dagRadial",Cn({nodes:d,edges:y,mode:t,nodeLevelRatio:n})).stop();let _;if(u){let M=p;if(d!=null&&d.length){const G=Math.ceil(d.length/200);M=p*G}_=wn().strength(i).template(C).groupBy(G=>G.data[u]).links(y).size([100,100]).linkStrengthInterCluster(c).linkStrengthIntraCluster(h).forceLinkDistance(m).forceLinkStrength(v).forceCharge(M).forceNodeSize(G=>G.radius)}let A=F.numDimensions(o).nodes(d);if(_&&(A=A.force("group",_)),r){let M=A.force("link");M&&(M.id(G=>G.id).links(y).distance(r),_&&(M=M.strength((_==null?void 0:_.getLinkStrength)??.1)))}const N=new Map(d.map(M=>[M.id,M]));return{step(){for(;F.alpha()>.01;)F.tick();return!0},getNodePosition(M){var G,k;if(x){const T=x(M,{graph:e,drags:b,nodes:d,edges:y});if(T)return T}return(G=b==null?void 0:b[M])!=null&&G.position?(k=b==null?void 0:b[M])==null?void 0:k.position:N.get(M)}}}function zn({graph:e,radius:n,drags:t,getNodePosition:o}){const s=on(e,{scale:n}),{nodes:r,edges:i}=ge(e);return{step(){return!0},getNodePosition(c){var h,m;if(o){const v=o(c,{graph:e,drags:t,nodes:r,edges:i});if(v)return v}return(h=t==null?void 0:t[c])!=null&&h.position?(m=t==null?void 0:t[c])==null?void 0:m.position:s==null?void 0:s[c]}}}const Sn={td:{x:"x",y:"y",factor:-1},lr:{x:"y",y:"x",factor:1}};function Ue({graph:e,drags:n,mode:t="td",nodeSeparation:o=1,nodeSize:s=[50,50],getNodePosition:r}){const{nodes:i,edges:c}=ge(e),{depths:h}=pt(i,c),m=Object.keys(h).map(u=>h[u]),v=rn().id(u=>u.data.id).parentId(u=>{var f,d,y;return(y=(d=(f=u.ins)==null?void 0:f[0])==null?void 0:d.data)==null?void 0:y.id})(m),p=sn().separation(()=>o).nodeSize(s)(ut(v)).descendants(),x=Sn[t],b=new Map(i.map(u=>{const{x:f,y:d}=p.find(y=>y.data.id===u.id);return[u.id,{...u,[x.x]:f*x.factor,[x.y]:d*x.factor,z:0}]}));return{step(){return!0},getNodePosition(u){var f,d;if(r){const y=r(u,{graph:e,drags:n,nodes:i,edges:c});if(y)return y}return(f=n==null?void 0:n[u])!=null&&f.position?(d=n==null?void 0:n[u])==null?void 0:d.position:b.get(u)}}}function Rn({graph:e,margin:n,drags:t,getNodePosition:o,ratio:s,gridSize:r,maxIterations:i}){const{nodes:c,edges:h}=ge(e),m=cn(e,{maxIterations:i,inputReducer:(v,C)=>({...C,x:C.x||0,y:C.y||0}),settings:{ratio:s,margin:n,gridSize:r}});return{step(){return!0},getNodePosition(v){var C,p;if(o){const x=o(v,{graph:e,drags:t,nodes:c,edges:h});if(x)return x}return(C=t==null?void 0:t[v])!=null&&C.position?(p=t==null?void 0:t[v])==null?void 0:p.position:m==null?void 0:m[v]}}}function On({graph:e,drags:n,iterations:t,...o}){an.assign(e);const s=ln(e,{iterations:t,settings:o});return{step(){return!0},getNodePosition(r){var i;return((i=n==null?void 0:n[r])==null?void 0:i.position)||(s==null?void 0:s[r])}}}function In({graph:e,drags:n,getNodePosition:t}){const{nodes:o,edges:s}=ge(e);return{step(){return!0},getNodePosition(r){return t(r,{graph:e,drags:n,nodes:o,edges:s})}}}const kn=["forceDirected2d","treeTd2d","treeLr2d","radialOut2d","treeTd3d","treeLr3d","radialOut3d","forceDirected3d"];function Ln({type:e,...n}){if(kn.includes(e)){const{nodeStrength:t,linkDistance:o,nodeLevelRatio:s}=n;if(e==="forceDirected2d")return re({...n,dimensions:2,nodeLevelRatio:s||2,nodeStrength:t||-250,linkDistance:o,forceLayout:e});if(e==="treeTd2d")return re({...n,mode:"td",dimensions:2,nodeLevelRatio:s||5,nodeStrength:t||-250,linkDistance:o||50,forceLayout:e});if(e==="treeLr2d")return re({...n,mode:"lr",dimensions:2,nodeLevelRatio:s||5,nodeStrength:t||-250,linkDistance:o||50,forceLayout:e});if(e==="radialOut2d")return re({...n,mode:"radialout",dimensions:2,nodeLevelRatio:s||5,nodeStrength:t||-500,linkDistance:o||100,forceLayout:e});if(e==="treeTd3d")return re({...n,mode:"td",dimensions:3,nodeLevelRatio:s||2,nodeStrength:t||-500,linkDistance:o||50});if(e==="treeLr3d")return re({...n,mode:"lr",dimensions:3,nodeLevelRatio:s||2,nodeStrength:t||-500,linkDistance:o||50,forceLayout:e});if(e==="radialOut3d")return re({...n,mode:"radialout",dimensions:3,nodeLevelRatio:s||2,nodeStrength:t||-500,linkDistance:o||100,forceLayout:e});if(e==="forceDirected3d")return re({...n,dimensions:3,nodeLevelRatio:s||2,nodeStrength:t||-250,linkDistance:o,forceLayout:e})}else if(e==="circular2d"){const{radius:t}=n;return zn({...n,radius:t||300})}else{if(e==="hierarchicalTd")return Ue({...n,mode:"td"});if(e==="hierarchicalLr")return Ue({...n,mode:"lr"});if(e==="nooverlap"){const{graph:t,maxIterations:o,ratio:s,margin:r,gridSize:i,...c}=n;return Rn({type:"nooverlap",graph:t,margin:r||10,maxIterations:o||50,ratio:s||10,gridSize:i||20,...c})}else if(e==="forceatlas2"){const{graph:t,iterations:o,gravity:s,scalingRatio:r,...i}=n;return On({type:"forceatlas2",graph:t,...i,scalingRatio:r||100,gravity:s||10,iterations:o||50})}else if(e==="custom")return In({type:"custom",...n})}throw new Error(`Layout ${e} not found.`)}const Mn=20;function gt({nodeCount:e,nodePosition:n,labelType:t,camera:o}){return(s,r)=>{var i;return o&&n&&((i=o==null?void 0:o.position)==null?void 0:i.z)/(o==null?void 0:o.zoom)-(n==null?void 0:n.z)>6e3?!1:t==="all"||t==="nodes"&&s==="node"||t==="edges"&&s==="edge"?!0:t==="auto"&&s==="node"?e<=Mn?!0:r>7:!1}}function vt(e,n){switch(n){case"above":return e;case"below":return-e;case"inline":case"natural":default:return 0}}function Dn({graph:e}){const n=pn(e);return{ranks:n,getSizeForNode:t=>n[t]*80}}function An({graph:e}){const n=gn(e);return{ranks:n,getSizeForNode:t=>n[t]*20}}function Pn({graph:e,attribute:n,defaultSize:t}){const o=new Map;return n?e.forEachNode((s,r)=>{var i;const c=(i=r.data)==null?void 0:i[n];isNaN(c)&&console.warn(`Attribute ${c} is not a number for node ${r.id}`),o.set(s,c||0)}):console.warn("Attribute sizing configured but no attribute provided"),{getSizeForNode:s=>!n||!o?t:o.get(s)}}const He={pagerank:Dn,centrality:An,attribute:Pn,none:({defaultSize:e})=>({getSizeForNode:n=>e})};function Nn({type:e,...n}){var t;const o=(t=He[e])==null?void 0:t.call(He,n);if(!o&&e!=="default")throw new Error(`Unknown sizing strategy: ${e}`);const{graph:s,minSize:r,maxSize:i}=n,c=new Map;let h,m;if(s.forEachNode((v,C)=>{let p;e==="default"?p=C.size||n.defaultSize:p=o.getSizeForNode(v),(h===void 0||p<h)&&(h=p),(m===void 0||p>m)&&(m=p),c.set(v,p)}),e!=="none"){const v=un().domain([h,m]).rangeRound([r,i]);for(const[C,p]of c)c.set(C,v(p))}return c}function Tn(e,n,t){e.clear();for(const o of n)try{e.addNode(o.id,o)}catch({message:s}){console.error(`[Graph] ${s}`)}for(const o of t)try{e.addEdge(o.source,o.target,o)}catch({message:s}){console.error(`[Graph] ${s}`)}return e}function jn({graph:e,layout:n,sizingType:t,labelType:o,sizingAttribute:s,defaultNodeSize:r,minNodeSize:i,maxNodeSize:c}){const h=[],m=[],v=new Map,C=Nn({graph:e,type:t,attribute:s,minSize:i,maxSize:c,defaultSize:r}),p=e.nodes().length,x=gt({nodeCount:p,labelType:o});return e.forEachNode((b,u)=>{const f=n.getNodePosition(b),{data:d,fill:y,icon:g,label:S,size:E,...P}=u,F=C.get(u.id),_=x("node",F),N=(e.inboundNeighbors(u.id)||[]).map(G=>e.getNodeAttributes(G)),M={...u,size:F,labelVisible:_,label:S,icon:g,fill:y,parents:N,data:{...P,...d??{}},position:{...f,x:f.x||0,y:f.y||0,z:f.z||1}};v.set(u.id,M),h.push(M)}),e.forEachEdge((b,u)=>{const f=v.get(u.source),d=v.get(u.target);if(f&&d){const{data:y,id:g,label:S,size:E,...P}=u,F=x("edge",E);m.push({...u,id:g,label:S,labelVisible:F,size:E,data:{...P,id:g,...y||{}}})}}),{nodes:h,edges:m}}const ee={mass:10,tension:1e3,friction:300,precision:.1};function ht(e,n,t){const o=n.getLength(),s=e==="end"?o:o/2,r=e==="end"?t/2:0,i=(s-r)/o,c=n.getPointAt(i),h=n.getTangentAt(i);return[c,h]}function mt(e){return[e+6,2+e/1.5]}const Re=.7;function yt(e,n,t=0){const o=new K(e.x,e.y||0,e.z||0),s=new K(n.x,n.y||0,n.z||0),r=new K().addVectors(o,s).divideScalar(2);return r.setLength(r.length()+t)}function Vn(e,n,t=-1){const o=e.clone(),s=n.clone(),r=new K().subVectors(s,o),i=r.length(),c=r.clone().normalize(),h=new K().subVectors(s,o).divideScalar(2),m=Math.abs(c.x)%1,v=new K(-c.y,c.x-m*c.z,m*c.y).normalize(),C=new K().add(o).add(h).add(v.multiplyScalar(i/4).multiplyScalar(t));return[e,C,n]}function fe(e,n,t,o,s,r){const i=Ye(e,t,n),c=Ye(t,e,o);return s?new Yt(...Vn(i,c,r)):new Wt(i,c)}function pe(e){return new K(e.position.x,e.position.y,e.position.z||0)}function Ye(e,n,t){const o=e.distanceTo(n);return e.clone().add(n.clone().sub(e).multiplyScalar(t/o))}function We(e,n){return{...e,position:{...e.position,x:e.position.x+n.x,y:e.position.y+n.y,z:e.position.z+n.z}}}function Gn({edge:e,edges:n,curved:t}){let o=t,s;const r=n.filter(i=>i.target===e.target&&i.source===e.source).map(i=>i.id);if(r.length>1){o=!0;const i=r.indexOf(e.id);r.length===2?s=i===0?Re:-Re:s=(i-Math.floor(r.length/2))*Re}return{curved:o,curveOffset:s}}function De(e){let n=Number.POSITIVE_INFINITY,t=Number.NEGATIVE_INFINITY,o=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY,r=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY;for(let c of e)n=Math.min(n,c.position.x),t=Math.max(t,c.position.x),o=Math.min(o,c.position.y),s=Math.max(s,c.position.y),r=Math.min(r,c.position.z),i=Math.max(i,c.position.z);return{height:s-o,width:t-n,minX:n,maxX:t,minY:o,maxY:s,minZ:r,maxZ:i,x:(t+n)/2,y:(s+o)/2,z:(i+r)/2}}function Fn(e,n){return n?e.reduce((t,o)=>{const s=o.data[n];return s&&t.set(s,[...t.get(s)||[],o]),t},new Map):new Map}function Bn({nodes:e,clusterAttribute:n}){const t=new Map;if(n){const o=Fn(e,n);for(const[s,r]of o){const i=De(r);t.set(s,{label:s,nodes:r,position:i})}}return t}const Ae=({sensitivity:e=7,interval:n=50,timeout:t=0,disabled:o,onPointerOver:s,onPointerOut:r})=>{const i=l.useRef(!1),c=l.useRef(null),h=l.useRef(0),m=l.useRef({x:null,y:null,px:null,py:null}),v=l.useCallback(f=>{m.current.x=f.clientX,m.current.y=f.clientY},[]),C=l.useCallback(f=>{c.current=clearTimeout(c.current);const{px:d,x:y,py:g,y:S}=m.current;Math.abs(d-y)+Math.abs(g-S)<e?(h.current=1,s(f)):(m.current.px=y,m.current.py=S,c.current=setTimeout(()=>C(f),n))},[n,s,e]),p=l.useCallback(()=>{clearTimeout(c.current),typeof window<"u"&&document.removeEventListener("mousemove",v,!1)},[v]),x=l.useCallback(f=>{o||(i.current=!0,p(),h.current!==1&&(m.current.px=f.pointer.x,m.current.py=f.pointer.y,typeof window<"u"&&document.addEventListener("mousemove",v,!1),c.current=setTimeout(()=>C(f),t)))},[p,C,o,v,t]),b=l.useCallback(f=>{c.current=clearTimeout(c.current),h.current=0,r(f)},[r]),u=l.useCallback(f=>{i.current=!1,p(),h.current===1&&(c.current=setTimeout(()=>b(f),t))},[p,b,t]);return{pointerOver:x,pointerOut:u}},Un=({draggable:e,set:n,position:t,onDragStart:o,onDragEnd:s})=>{const r=$(u=>u.camera),i=$(u=>u.raycaster),c=$(u=>u.size),h=$(u=>u.gl),{mouse2D:m,mouse3D:v,offset:C,normal:p,plane:x}=l.useMemo(()=>({mouse2D:new ue,mouse3D:new K,offset:new K,normal:new K,plane:new Kt}),[]),b=l.useMemo(()=>h.domElement.getBoundingClientRect(),[h.domElement]);return Xt({onDragStart:({event:u})=>{const{eventObject:f,point:d}=u;f.getWorldPosition(C).sub(d),v.copy(d),o()},onDrag:({event:u})=>{const f=(u.clientX-((b==null?void 0:b.left)??0))/c.width*2-1,d=-((u.clientY-((b==null?void 0:b.top)??0))/c.height)*2+1;m.set(f,d),i.setFromCamera(m,r),r.getWorldDirection(p).negate(),x.setFromNormalAndCoplanarPoint(p,v),i.ray.intersectPlane(x,v);const y=new K(t.x,t.y,t.z).copy(v).add(C);return n(y)},onDragEnd:s},{drag:{enabled:e,threshold:10}})},{Provider:Hn,useStore:I}=En(),Yn=({actives:e=[],selections:n=[],collapsedNodeIds:t=[],theme:o})=>bn(s=>({theme:{...o,edge:{...o.edge,label:{...o.edge.label,fontSize:o.edge.label.fontSize??6}}},edges:[],nodes:[],collapsedNodeIds:t,clusters:new Map,panning:!1,draggingId:null,actives:e,edgeContextMenus:new Set,edgeMeshes:[],selections:n,drags:{},graph:new $t({multi:!0}),setTheme:r=>s(i=>({...i,theme:r})),setClusters:r=>s(i=>({...i,clusters:r})),setEdgeContextMenus:r=>s(i=>({...i,edgeContextMenus:r})),setEdgeMeshes:r=>s(i=>({...i,edgeMeshes:r})),setPanning:r=>s(i=>({...i,panning:r})),setDrags:r=>s(i=>({...i,drags:r})),setDraggingId:r=>s(i=>({...i,draggingId:r})),setActives:r=>s(i=>({...i,actives:r})),setSelections:r=>s(i=>({...i,selections:r})),setNodes:r=>s(i=>({...i,nodes:r,centerPosition:De(r)})),setEdges:r=>s(i=>({...i,edges:r})),setNodePosition:(r,i)=>s(c=>{var h,m;const v=c.nodes.find(u=>u.id===r),C=pe(v),x=new K(i.x,i.y,i.z).sub(C),b=[...c.nodes];if((h=c.selections)!=null&&h.includes(r))(m=c.selections)==null||m.forEach(u=>{const f=c.nodes.find(d=>d.id===u);if(f){const d=c.nodes.indexOf(f);b[d]=We(f,x)}});else{const u=c.nodes.indexOf(v);b[u]=We(v,x)}return{...c,drags:{...c.drags,[r]:v},nodes:b}}),setCollapsedNodeIds:(r=[])=>s(i=>({...i,collapsedNodeIds:r}))}));function bt({nodeId:e,nodes:n,edges:t,currentHiddenNodes:o,currentHiddenEdges:s}){const r=[],i=[],c=o.map(x=>x.id),h=s.map(x=>x.id),m=t.filter(x=>x.source===e),v=m.map(x=>x.target);i.push(...m);for(const x of v){const b=t.filter(f=>f.target===x&&f.source!==e);let u=!1;if((b.length===0||b.length>0&&!c.includes(x)&&b.map(d=>d.id).every(d=>h.includes(d)))&&(u=!0),u){const f=n.find(y=>y.id===x);f&&r.push(f);const d=bt({nodeId:x,nodes:n,edges:t,currentHiddenEdges:i,currentHiddenNodes:r});i.push(...d.hiddenEdges),r.push(...d.hiddenNodes)}}const C=Object.values(i.reduce((x,b)=>({...x,[b.id]:b}),{})),p=Object.values(r.reduce((x,b)=>({...x,[b.id]:b}),{}));return{hiddenEdges:C,hiddenNodes:p}}const Wn=({collapsedIds:e,nodes:n,edges:t})=>{const o=[],s=[];for(const m of e){const{hiddenEdges:v,hiddenNodes:C}=bt({nodeId:m,nodes:n,edges:t,currentHiddenEdges:s,currentHiddenNodes:o});o.push(...C),s.push(...v)}const r=o.map(m=>m.id),i=s.map(m=>m.id),c=n.filter(m=>!r.includes(m.id)),h=t.filter(m=>!i.includes(m.id));return{visibleNodes:c,visibleEdges:h}},Kn=({layoutType:e,sizingType:n,labelType:t,sizingAttribute:o,clusterAttribute:s,selections:r,nodes:i,edges:c,actives:h,collapsedNodeIds:m,defaultNodeSize:v,maxNodeSize:C,minNodeSize:p,layoutOverrides:x})=>{const b=I(a=>a.graph),u=I(a=>a.setClusters),f=I(a=>a.collapsedNodeIds),d=I(a=>a.setEdges),y=I(a=>a.nodes),g=I(a=>a.setNodes),S=I(a=>a.setSelections),E=I(a=>a.setActives),P=I(a=>a.drags),F=I(a=>a.setDrags),_=I(a=>a.setCollapsedNodeIds),A=l.useRef(!1),N=l.useRef(null),M=$(a=>a.camera),{visibleEdges:G,visibleNodes:k}=l.useMemo(()=>Wn({collapsedIds:f,nodes:i,edges:c}),[f,i,c]),T=l.useRef(P);l.useEffect(()=>{T.current=P},[P]);const j=l.useCallback(async a=>{N.current=a||Ln({...x,type:e,graph:b,drags:T.current,clusterAttribute:s}),await _n(N.current);const R=jn({graph:b,layout:N.current,sizingType:n,labelType:t,sizingAttribute:o,maxNodeSize:C,minNodeSize:p,defaultNodeSize:v}),w=Bn({nodes:R.nodes,clusterAttribute:s});d(R.edges),g(R.nodes),u(w)},[x,e,s,n,t,o,C,p,v,d,g,u]);l.useEffect(()=>{const a=y.map(w=>({...w,labelVisible:gt({nodeCount:y==null?void 0:y.length,labelType:t,camera:M,nodePosition:w==null?void 0:w.position})("node",w==null?void 0:w.size)}));a.some((w,L)=>w.labelVisible!==y[L].labelVisible)&&g(a)},[M,M.zoom,M.position.z,g,y,t]),l.useEffect(()=>{A.current&&S(r)},[r,S]),l.useEffect(()=>{A.current&&E(h)},[h,E]),l.useEffect(()=>{async function a(){A.current=!1,Tn(b,k,G),await j(),A.current=!0}a()},[k,G]),l.useEffect(()=>{A.current&&_(m)},[m,_]),l.useEffect(()=>{A.current&&(T.current={},F({}),j())},[e,j,F]),l.useEffect(()=>{A.current&&j(N.current)},[n,o,t,j])},ce=({text:e,fontSize:n,fontUrl:t,color:o,opacity:s,stroke:r,active:i,ellipsis:c})=>{const h=c&&!i?Zt(e,c):e,m=l.useMemo(()=>new se(o),[o]),v=l.useMemo(()=>r?new se(r):void 0,[r]);return z.jsx(st,{position:[0,0,1],children:z.jsx(qt,{font:t,fontSize:n,color:m,fillOpacity:s,textAlign:"center",outlineWidth:r?1:0,outlineColor:v,depthOffset:0,maxWidth:100,overflowWrap:"break-word",children:h})})};ce.defaultProps={opacity:1,fontSize:7,color:"#2A6475",ellipsis:75};const xt=({color:e,id:n,size:t,opacity:o,animated:s})=>{const{scale:r,nodeOpacity:i}=J({from:{scale:[1e-5,1e-5,1e-5],nodeOpacity:0},to:{scale:[t,t,t],nodeOpacity:o},config:{...ee,duration:s?void 0:0}}),c=l.useMemo(()=>new se(e),[e]);return z.jsxs(W.mesh,{userData:{id:n,type:"node"},scale:r,children:[z.jsx("sphereGeometry",{attach:"geometry",args:[1,25,25]}),z.jsx(W.meshPhongMaterial,{attach:"material",side:ne,transparent:!0,fog:!0,opacity:i,color:c})]})};xt.defaultProps={opacity:1,active:!1};const Et=({color:e,size:n,opacity:t,animated:o,strokeWidth:s})=>{const r=l.useMemo(()=>new se(e),[e]),{ringSize:i,ringOpacity:c}=J({from:{ringOpacity:0,ringSize:[1e-5,1e-5,1e-5]},to:{ringOpacity:t,ringSize:[n/2,n/2,1]},config:{...ee,duration:o?void 0:0}});return z.jsx(st,{position:[0,0,1],children:z.jsxs(W.mesh,{scale:i,children:[z.jsx("ringGeometry",{attach:"geometry",args:[4,4+s,25]}),z.jsx(W.meshBasicMaterial,{attach:"material",color:r,transparent:!0,depthTest:!1,opacity:c,side:ne,fog:!0})]})})};Et.defaultProps={color:"#D8E6EA",size:1,opacity:.5,strokeWidth:.5};const Ct=l.createContext({controls:null,resetControls:()=>{},zoomIn:()=>{},zoomOut:()=>{},panLeft:()=>{},panRight:()=>{},panUp:()=>{},panDown:()=>{}}),Pe=()=>{const e=l.useContext(Ct);if(e===void 0)throw new Error("`useCameraControls` hook must be used within a `ControlsProvider` component");return e};q.install({THREE:{MOUSE:Pt,Vector2:ue,Vector3:K,Vector4:Nt,Quaternion:et,Matrix4:Tt,Spherical:jt,Box3:tt,Sphere:Vt,Raycaster:Gt,MathUtils:{DEG2RAD:(Ge=Oe)==null?void 0:Ge.DEG2RAD,clamp:(Fe=Oe)==null?void 0:Fe.clamp}}});Ft({ThreeCameraControls:q});const Ce={ARROW_LEFT:37,ARROW_UP:38,ARROW_RIGHT:39,ARROW_DOWN:40},Ke=new Ee(Ce.ARROW_LEFT,100),Xe=new Ee(Ce.ARROW_RIGHT,100),$e=new Ee(Ce.ARROW_UP,100),Ze=new Ee(Ce.ARROW_DOWN,100),_t=l.forwardRef(({mode:e,children:n,animated:t,disabled:o},s)=>{const r=l.useRef(null),i=$(g=>g.camera),c=$(g=>g.gl),h=e==="orbit",m=I(g=>g.setPanning);nt((g,S)=>{var E,P;(E=r.current)!=null&&E.enabled&&((P=r.current)==null||P.update(S)),h&&(r.current.azimuthAngle+=20*S*Oe.DEG2RAD)},-1),l.useEffect(()=>()=>{var g;return(g=r.current)==null?void 0:g.dispose()},[]);const v=l.useCallback(()=>{var g;(g=r.current)==null||g.zoom(i.zoom/2,t)},[t,i.zoom]),C=l.useCallback(()=>{var g;(g=r.current)==null||g.zoom(-i.zoom/2,t)},[t,i.zoom]),p=l.useCallback(g=>{var S;h||(S=r.current)==null||S.truck(-.03*g.deltaTime,0,t)},[t,h]),x=l.useCallback(g=>{var S;h||(S=r.current)==null||S.truck(.03*g.deltaTime,0,t)},[t,h]),b=l.useCallback(g=>{var S;h||(S=r.current)==null||S.truck(0,.03*g.deltaTime,t)},[t,h]),u=l.useCallback(g=>{var S;h||(S=r.current)==null||S.truck(0,-.03*g.deltaTime,t)},[t,h]),f=l.useCallback(g=>{g.code==="Space"&&(e==="rotate"?r.current.mouseButtons.left=q.ACTION.TRUCK:r.current.mouseButtons.left=q.ACTION.ROTATE)},[e]),d=l.useCallback(g=>{g.code==="Space"&&(e==="rotate"?r.current.mouseButtons.left=q.ACTION.ROTATE:r.current.mouseButtons.left=q.ACTION.TRUCK)},[e]);l.useEffect(()=>(o||(Ke.addEventListener("holding",x),Xe.addEventListener("holding",p),$e.addEventListener("holding",b),Ze.addEventListener("holding",u),typeof window<"u"&&(window.addEventListener("keydown",f),window.addEventListener("keyup",d))),()=>{Ke.removeEventListener("holding",x),Xe.removeEventListener("holding",p),$e.removeEventListener("holding",b),Ze.removeEventListener("holding",u),typeof window<"u"&&(window.removeEventListener("keydown",f),window.removeEventListener("keyup",d))}),[o,f,d,u,x,p,b]),l.useEffect(()=>{o?(r.current.mouseButtons.left=q.ACTION.NONE,r.current.mouseButtons.middle=q.ACTION.NONE,r.current.mouseButtons.wheel=q.ACTION.NONE):(r.current.mouseButtons.left=q.ACTION.TRUCK,r.current.mouseButtons.middle=q.ACTION.TRUCK,r.current.mouseButtons.wheel=q.ACTION.DOLLY)},[o]),l.useEffect(()=>{const g=()=>m(!0),S=()=>m(!1),E=r.current;return E&&(E.addEventListener("control",g),E.addEventListener("controlend",S)),()=>{E&&(E.removeEventListener("control",g),E.removeEventListener("controlend",S))}},[r,m]),l.useEffect(()=>{e==="rotate"?r.current.mouseButtons.left=q.ACTION.ROTATE:r.current.mouseButtons.left=q.ACTION.TRUCK},[e]),ot([{name:"Zoom In",disabled:o,category:"Graph",keys:"command+shift+i",callback:g=>{g.preventDefault(),v()}},{name:"Zoom Out",category:"Graph",disabled:o,keys:"command+shift+o",callback:g=>{g.preventDefault(),C()}}]);const y=l.useMemo(()=>({controls:r.current,zoomIn:()=>v(),zoomOut:()=>C(),panLeft:(g=100)=>x({deltaTime:g}),panRight:(g=100)=>p({deltaTime:g}),panDown:(g=100)=>u({deltaTime:g}),panUp:(g=100)=>b({deltaTime:g}),resetControls:g=>{var S;return(S=r.current)==null?void 0:S.reset(g)}}),[v,C,x,p,u,b,r.current]);return l.useImperativeHandle(s,()=>y),z.jsxs(Ct.Provider,{value:y,children:[z.jsx("threeCameraControls",{ref:r,args:[i,c.domElement],smoothTime:.1,minDistance:1e3,dollyToCursor:!0,maxDistance:5e4}),n]})});_t.defaultProps={mode:"rotate"};function wt(e,n){const t=n.position.z;e<t?e-=t:e+=t;const o=n.fov/n.zoom*Math.PI/180;return 2*Math.tan(o/2)*Math.abs(e)}function Xn(e,n){return wt(e,n)*n.aspect}function $n(e,n){var t,o,s,r;const i=Xn(1,e),c=wt(1,e),h={x0:((t=e==null?void 0:e.position)==null?void 0:t.x)-i/2,x1:((o=e==null?void 0:e.position)==null?void 0:o.x)+i/2,y0:((s=e==null?void 0:e.position)==null?void 0:s.y)-c/2,y1:((r=e==null?void 0:e.position)==null?void 0:r.y)+c/2};return(n==null?void 0:n.x)>h.x0&&(n==null?void 0:n.x)<h.x1&&(n==null?void 0:n.y)>h.y0&&(n==null?void 0:n.y)<h.y1}function qe(e,n){return n.reduce((t,o)=>Math.abs(o-e%Math.PI)<Math.abs(t-e%Math.PI)?o:t)}function Zn(e,n){const t=qe(e,[0,Math.PI]),o=qe(n,[Math.PI/2,3*Math.PI/2]);return{horizontalRotation:t-e%Math.PI,verticalRotation:o-n%Math.PI}}const be=50,qn=({animated:e,disabled:n,layoutType:t})=>{const o=I(p=>p.nodes),[s,r]=l.useState(!1),i=$(p=>p.invalidate),{controls:c}=Pe(),h=$(p=>p.camera),m=l.useRef(!1),v=l.useCallback(async(p,x=!0)=>{if(p!=null&&p.some(b=>!$n(h,b.position))||!m.current){const{minX:b,maxX:u,minY:f,maxY:d,minZ:y,maxZ:g,x:S,y:E,z:P}=De(p);if(!t.includes("3d")){const{horizontalRotation:F,verticalRotation:_}=Zn(c==null?void 0:c.azimuthAngle,c==null?void 0:c.polarAngle);c==null||c.rotate(F,_,!0)}await(c==null?void 0:c.fitToBox(new tt(new K(b,f,y),new K(u,d,g)),x,{cover:!1,paddingLeft:be,paddingRight:be,paddingBottom:be,paddingTop:be})),await c.setTarget(S,E,P,x),s||r(!0),i()}},[i,c,e,o]),C=l.useCallback(p=>{let x=null;p!=null&&p.length&&(x=p.reduce((b,u)=>{const f=o.find(d=>d.id===u);if(f)b.push(f);else throw new Error(`Attempted to center ${u} but it was not found in the nodes`);return b},[])),v(x||o)},[v,o]);return l.useLayoutEffect(()=>{async function p(){c&&(o!=null&&o.length)&&(m.current?await v(o,e):(await v(o,!1),m.current=!0))}p()},[c,v,o,e]),ot([{name:"Center",disabled:n,category:"Graph",keys:["command+shift+c"],callback:()=>v(o)}]),{centerNodes:v,centerNodesById:C,isCentered:s}},zt=({image:e,id:n,size:t,opacity:o,animated:s})=>{const r=l.useMemo(()=>new Qt().load(e),[e]),{scale:i,spriteOpacity:c}=J({from:{scale:[1e-5,1e-5,1e-5],spriteOpacity:0},to:{scale:[t,t,t],spriteOpacity:o},config:{...ee,duration:s?void 0:0}});return z.jsx(W.sprite,{userData:{id:n,type:"node"},scale:i,children:z.jsx(W.spriteMaterial,{attach:"material",opacity:c,fog:!0,depthTest:!1,transparent:!0,side:ne,children:z.jsx("primitive",{attach:"map",object:r,minFilter:Jt})})})};zt.defaultProps={opacity:1};const St=({animated:e,disabled:n,id:t,draggable:o,labelFontUrl:s,contextMenu:r,onClick:i,onDoubleClick:c,onPointerOver:h,onDragged:m,onPointerOut:v,onContextMenu:C,renderNode:p})=>{var x,b,u;const f=Pe(),d=I(B=>B.theme),y=I(B=>B.nodes.find(Z=>Z.id===t)),g=I(B=>B.edges),S=I(B=>B.draggingId),E=I(B=>B.collapsedNodeIds),P=I(B=>B.setDraggingId),F=I(B=>B.setNodePosition),_=I(B=>B.setCollapsedNodeIds),A=I(B=>B.collapsedNodeIds.includes(t)),N=I(B=>{var Z;return(Z=B.actives)==null?void 0:Z.includes(t)}),M=I(B=>{var Z;return(Z=B.selections)==null?void 0:Z.includes(t)}),G=I(B=>{var Z;return((Z=B.selections)==null?void 0:Z.length)>0}),k=I(B=>B.centerPosition),T=S===t,{position:j,label:a,subLabel:R,size:w=7,labelVisible:L=!0}=y,O=l.useRef(null),[V,D]=l.useState(!1),[X,Y]=l.useState(!1),te=V||M||N,Q=G?te?d.node.selectedOpacity:d.node.inactiveOpacity:d.node.opacity,oe=l.useMemo(()=>g.filter(Z=>Z.source===t).length>0||A,[g,t,A]),ae=l.useCallback(()=>{oe&&_(A?E.filter(B=>B!==t):[...E,t])},[oe,E,t,A,_]),[{nodePosition:_e,labelPosition:ve,subLabelPosition:he}]=J(()=>({from:{nodePosition:k?[k.x,k.y,0]:[0,0,0],labelPosition:[0,-(w+7),2],subLabelPosition:[0,-(w+14),2]},to:{nodePosition:j?[j.x,j.y,te?j.z+1:j.z]:[0,0,0],labelPosition:[0,-(w+7),2],subLabelPosition:[0,-(w+14),2]},config:{...ee,duration:e&&!S?void 0:0}}),[T,j,e,w,te]),U=Un({draggable:o,position:j,set:B=>F(t,B),onDragStart:()=>{P(t),D(!0)},onDragEnd:()=>{P(null),D(!1),m==null||m(y)}});de(V&&!S&&i!==void 0,"pointer"),de(V&&o&&!T&&i===void 0,"grab"),de(T,"grabbing");const H=te||T,ie=H?d.node.activeFill:y.fill||d.node.fill,{pointerOver:we,pointerOut:le}=Ae({disabled:n||T,onPointerOver:()=>{f.controls.truckSpeed=0,D(!0),h==null||h(y)},onPointerOut:()=>{f.controls.truckSpeed=2,D(!1),v==null||v(y)}}),me=l.useMemo(()=>p?p({id:t,color:ie,size:w,active:H,opacity:Q,animated:e,node:y}):z.jsx(z.Fragment,{children:y.icon?z.jsx(zt,{id:t,image:y.icon||"",size:w+8,opacity:Q,animated:e,color:ie,node:y,active:H}):z.jsx(xt,{id:t,size:w,opacity:Q,animated:e,color:ie,node:y,active:H})}),[p,t,ie,w,H,Q,e,y]),ze=l.useMemo(()=>{var B,Z,Ne;return(L||M||V)&&a&&z.jsxs(z.Fragment,{children:[z.jsx(W.group,{position:ve,children:z.jsx(ce,{text:a,fontUrl:s,opacity:Q,stroke:d.node.label.stroke,active:M||V||T||N,color:M||V||T||N?d.node.label.activeColor:d.node.label.color})}),R&&z.jsx(W.group,{position:he,children:z.jsx(ce,{text:R,fontUrl:s,fontSize:5,opacity:Q,stroke:(B=d.node.subLabel)==null?void 0:B.stroke,active:M||V||T||N,color:M||V||T||N?(Z=d.node.subLabel)==null?void 0:Z.activeColor:(Ne=d.node.subLabel)==null?void 0:Ne.color})})]})},[V,N,T,M,a,s,ve,L,Q,R,he,d.node.label.activeColor,d.node.label.color,d.node.label.stroke,(x=d.node.subLabel)==null?void 0:x.activeColor,(b=d.node.subLabel)==null?void 0:b.color,(u=d.node.subLabel)==null?void 0:u.stroke]),Dt=l.useMemo(()=>X&&r&&z.jsx(Me,{prepend:!0,center:!0,children:r({data:y,canCollapse:oe,isCollapsed:A,onCollapse:ae,onClose:()=>Y(!1)})}),[X,r,y,oe,A,ae]);return z.jsxs(W.group,{userData:{id:t,type:"node"},ref:O,position:_e,onPointerOver:we,onPointerOut:le,onClick:()=>{!n&&!T&&(i==null||i(y,{canCollapse:oe,isCollapsed:A}))},onDoubleClick:()=>{!n&&!T&&(c==null||c(y))},onContextMenu:()=>{n||(Y(!0),C==null||C(y,{canCollapse:oe,isCollapsed:A,onCollapse:ae}))},...U(),children:[me,z.jsx(Et,{opacity:M?.5:0,size:w,animated:e,color:M||V?d.ring.activeFill:d.ring.fill}),Dt,ze]})};St.defaultProps={draggable:!1};const Rt=({animated:e,color:n,length:t,opacity:o,position:s,rotation:r,size:i,onActive:c,onContextMenu:h})=>{const m=l.useMemo(()=>new se(n),[n]),v=l.useRef(null),C=I(f=>f.draggingId),p=I(f=>f.centerPosition),[{pos:x,arrowOpacity:b}]=J(()=>({from:{pos:p?[p.x,p.y,p.z]:[0,0,0],arrowOpacity:0},to:{pos:[s.x,s.y,s.z],arrowOpacity:o},config:{...ee,duration:e&&!C?void 0:0}}),[e,C,o,s]),u=l.useCallback(()=>{var f;const d=new K(0,1,0);(f=v.current)==null||f.quaternion.setFromUnitVectors(d,r)},[r,v]);return l.useEffect(()=>u(),[u]),z.jsxs(W.mesh,{position:x,ref:v,scale:[1,1,1],onPointerOver:()=>c(!0),onPointerOut:()=>c(!1),onPointerDown:f=>{f.nativeEvent.buttons===2&&(f.stopPropagation(),h())},children:[z.jsx("cylinderGeometry",{args:[0,i,t,20,1,!0],attach:"geometry"}),z.jsx(W.meshBasicMaterial,{attach:"material",color:m,depthTest:!1,opacity:b,transparent:!0,side:ne,fog:!0})]})};Rt.defaultProps={size:1,opacity:.5,color:"#D8E6EA"};const Ot=({curveOffset:e,animated:n,color:t,curve:o,curved:s=!1,id:r,opacity:i,size:c,onContextMenu:h,onClick:m,onPointerOver:v,onPointerOut:C})=>{const p=l.useRef(null),x=I(y=>y.draggingId),b=l.useMemo(()=>new se(t),[t]),u=I(y=>y.centerPosition),f=l.useRef(!1),{lineOpacity:d}=J({from:{lineOpacity:0},to:{lineOpacity:i},config:{...ee,duration:n?void 0:0}});return J(()=>{const y=o.getPoint(0),g=o.getPoint(1);return{from:{fromVertices:f.current?[g==null?void 0:g.x,g==null?void 0:g.y,(g==null?void 0:g.z)||0]:[u==null?void 0:u.x,u==null?void 0:u.y,(u==null?void 0:u.z)||0],toVertices:[y==null?void 0:y.x,y==null?void 0:y.y,(y==null?void 0:y.z)||0]},to:{fromVertices:[y==null?void 0:y.x,y==null?void 0:y.y,(y==null?void 0:y.z)||0],toVertices:[g==null?void 0:g.x,g==null?void 0:g.y,(g==null?void 0:g.z)||0]},onChange:S=>{const{fromVertices:E,toVertices:P}=S.value,F=new K(...E),_=new K(...P),A=fe(F,0,_,0,s,e);p.current.copy(new Ie(A,20,c/2,5,!1))},config:{...ee,duration:n&&!x?void 0:0}}},[n,x,o,c]),l.useEffect(()=>{f.current=!0},[]),z.jsxs("mesh",{userData:{id:r,type:"edge"},onPointerOver:v,onPointerOut:C,onClick:m,onPointerDown:y=>{y.nativeEvent.buttons===2&&(y.stopPropagation(),h())},children:[z.jsx("tubeGeometry",{attach:"geometry",ref:p}),z.jsx(W.meshBasicMaterial,{attach:"material",opacity:d,fog:!0,transparent:!0,depthTest:!1,color:b})]})};Ot.defaultProps={color:"#000",size:1,opacity:1};const Qe=3,It=({animated:e,arrowPlacement:n,contextMenu:t,disabled:o,labelPlacement:s,id:r,interpolation:i,labelFontUrl:c,onContextMenu:h,onClick:m,onPointerOver:v,onPointerOut:C})=>{const p=I(U=>U.theme),x=I(U=>U.draggingId),[b,u]=l.useState(!1),[f,d]=l.useState(!1),y=I(U=>U.edges),g=y.find(U=>U.id===r),{target:S,source:E,label:P,labelVisible:F=!1,size:_=1}=g,A=I(U=>U.nodes.find(H=>H.id===E)),N=I(U=>U.nodes.find(H=>H.id===S)),M=(_+p.edge.label.fontSize)/2,[G,k]=l.useMemo(()=>mt(_),[_]),{curveOffset:T,curved:j}=l.useMemo(()=>Gn({edge:g,edges:y,curved:i==="curved"}),[g,y,i]),[a,R,w]=l.useMemo(()=>{const U=pe(A),H=A.size,ie=pe(N),we=N.size;let le=fe(U,H,ie,we,j,T);const[me,ze]=ht(n,le,G);return n==="end"&&(le=fe(U,H,me,0,j,T)),[le,me,ze]},[A,N,j,T,n,G]),L=l.useMemo(()=>{let U=yt(A.position,N.position,vt(M,s));if(j){const H=new K().subVectors(U,a.getPoint(.5));switch(s){case"above":H.y=H.y-Qe;break;case"below":H.y=H.y+Qe;break}U=U.sub(H)}return U},[A.position,N.position,M,s,j,a]),O=I(U=>{var H;return(H=U.selections)==null?void 0:H.includes(r)}),V=I(U=>{var H;return(H=U.selections)==null?void 0:H.length}),D=I(U=>{var H;return(H=U.actives)==null?void 0:H.includes(r)}),X=I(U=>U.centerPosition),Y=V?O||D?p.edge.selectedOpacity:p.edge.inactiveOpacity:p.edge.opacity,[{labelPosition:te}]=J(()=>({from:{labelPosition:X?[X.x,X.y,X.z]:[0,0,0]},to:{labelPosition:[L.x,L.y,L.z]},config:{...ee,duration:e&&!x?void 0:0}}),[L,e,x]),Q=l.useMemo(()=>new rt(0,0,s==="natural"?0:Math.atan((N.position.y-A.position.y)/(N.position.x-A.position.x))),[N.position.x,N.position.y,A.position.x,A.position.y,s]);de(b&&!x&&m!==void 0,"pointer");const{pointerOver:oe,pointerOut:ae}=Ae({disabled:o,onPointerOver:()=>{u(!0),v==null||v(g)},onPointerOut:()=>{u(!1),C==null||C(g)}}),_e=l.useMemo(()=>n!=="none"&&z.jsx(Rt,{animated:e,color:O||b||D?p.arrow.activeFill:p.arrow.fill,length:G,opacity:Y,position:R,rotation:w,size:k,onActive:u,onContextMenu:()=>{o||(d(!0),h==null||h(g))}}),[b,e,G,n,R,w,k,o,g,D,O,h,Y,p.arrow.activeFill,p.arrow.fill]),ve=l.useMemo(()=>F&&P&&z.jsx(W.group,{position:te,rotation:Q,children:z.jsx(ce,{text:P,ellipsis:15,fontUrl:c,stroke:p.edge.label.stroke,color:O||b||D?p.edge.label.activeColor:p.edge.label.color,opacity:Y,fontSize:p.edge.label.fontSize})}),[b,D,O,P,c,te,Q,F,Y,p.edge.label.activeColor,p.edge.label.color,p.edge.label.fontSize,p.edge.label.stroke]),he=l.useMemo(()=>f&&t&&z.jsx(Me,{prepend:!0,center:!0,children:t({data:g,onClose:()=>d(!1)})}),[f,t,g]);return z.jsxs("group",{children:[z.jsx(Ot,{curveOffset:T,animated:e,color:O||b||D?p.edge.activeFill:p.edge.fill,curve:a,curved:j,id:r,opacity:Y,size:_,onClick:()=>{o||m==null||m(g)},onPointerOver:oe,onPointerOut:ae,onContextMenu:()=>{o||(d(!0),h==null||h(g))}}),_e,ve,he]})};It.defaultProps={labelPlacement:"inline",arrowPlacement:"end"};const Je=new Bt(0,0,0);function Qn(e,n){const t=l.useRef(),o=I(h=>h.theme);I(h=>{t.current=h});const s=l.useRef(new Map),r=n==="curved",i=l.useCallback(h=>{const m=[],v=s.current,{nodes:C}=t.current;return h.forEach(p=>{const{target:x,source:b,size:u=1}=p,f=C.find(a=>a.id===b),d=C.find(a=>a.id===x);if(!f||!d)return;const y=`fromX:${f.position.x},fromY:${f.position.y},toX:${d.position.x}},toY:${d.position.y}`;if(v.has(y)){const a=v.get(y);m.push(a);return}const g=pe(f),S=f.size+o.edge.label.fontSize,E=pe(d),P=d.size+o.edge.label.fontSize;let F=fe(g,S,E,P,r),_=new Ie(F,20,u/2,5,!1);if(e==="none"){m.push(_),v.set(y,_);return}const[A,N]=mt(u),[M,G]=ht(e,F,A),k=new et;k.setFromUnitVectors(new K(0,1,0),G);const T=new en(0,N,A,20,1,!0);if(T.applyQuaternion(k),T.translate(M.x,M.y,M.z),e&&e==="end"){const a=fe(g,S,M,0,r);_=new Ie(a,20,u/2,5,!1)}const j=ye([_,T]);m.push(j),v.set(y,j)}),m},[e,r,o.edge.label.fontSize]),c=l.useCallback((h,m)=>{const v=i(h),C=i(m);return ye([C.length?ye(C):Je,v.length?ye(v):Je],!0)},[i]);return{getGeometries:i,getGeometry:c}}function Jn(e,n,t){const{onClick:o,onContextMenu:s,onPointerOut:r,onPointerOver:i}=e,c=I(b=>b.edgeContextMenus),h=I(b=>b.setEdgeContextMenus),m=l.useRef(!1),v=l.useCallback(()=>{m.current=!0},[]),C=l.useRef(!1),p=l.useCallback(()=>{C.current=!0},[]),x=l.useCallback((b,u)=>{o&&m.current&&(m.current=!1,t||u.forEach(f=>{o(f)})),(n||s)&&C.current&&(C.current=!1,t||u.forEach(f=>{c.has(f.id)||(h(new Set([...c,f.id])),s==null||s(f))})),i&&u.filter(d=>!b.includes(d)).forEach(d=>{i(d)}),r&&b.filter(d=>!u.includes(d)).forEach(d=>{r(d)})},[n,t,c,h,o,s,i,r]);return{handleClick:v,handleContextMenu:p,handleIntersections:x}}function eo(e,n){const t=l.useRef(e);l.useEffect(()=>{t.current=e},[e]);const o=l.useCallback(()=>{const r=t.current.getAttribute("position"),i=Array.from({length:r.array.length}).fill(0),c=Array.from(r.array);return{from:i,to:c}},[]),s=l.useCallback(r=>{const i=new Float32Array(r),c=new tn(i,3,!1);t.current.setAttribute("position",c),c.needsUpdate=!0},[]);J(()=>{if(!n)return null;const r=o();return{from:{positions:r.from},to:{positions:r.to},onChange:i=>{s(i.value.positions)},config:{...ee,duration:n?void 0:0}}},[n])}function to(e,n,t){const[{activeOpacity:o,inactiveOpacity:s}]=J(()=>({from:{activeOpacity:0,inactiveOpacity:0},to:{activeOpacity:n?t.edge.selectedOpacity:t.edge.opacity,inactiveOpacity:n?t.edge.inactiveOpacity:t.edge.opacity},config:{...ee,duration:e?void 0:0}}),[e,n,t]);return{activeOpacity:o,inactiveOpacity:s}}const kt=({animated:e,color:n,contextMenu:t,edge:o,labelFontUrl:s,labelPlacement:r,opacity:i})=>{const c=I(_=>_.theme),{target:h,source:m,label:v,labelVisible:C=!1,size:p=1}=o,x=I(_=>_.nodes),b=x.find(_=>_.id===m),u=x.find(_=>_.id===h),f=I(_=>_.draggingId),d=(p+c.edge.label.fontSize)/2,y=l.useMemo(()=>yt(b.position,u.position,vt(d,r)),[b.position,u.position,d,r]),g=I(_=>_.edgeContextMenus),S=I(_=>_.setEdgeContextMenus),[{labelPosition:E}]=J(()=>({from:{labelPosition:[0,0,0]},to:{labelPosition:[y.x,y.y,y.z]},config:{...ee,duration:e&&!f?void 0:0}}),[y,e,f]),P=l.useCallback(_=>{g.delete(_.id),S(new Set(g.values()))},[g,S]),F=l.useMemo(()=>new rt(0,0,r==="natural"?0:Math.atan((u.position.y-b.position.y)/(u.position.x-b.position.x))),[u.position.x,u.position.y,b.position.x,b.position.y,r]);return z.jsxs("group",{children:[C&&v&&z.jsx(W.group,{position:E,rotation:F,children:z.jsx(ce,{text:v,ellipsis:15,fontUrl:s,stroke:c.edge.label.stroke,color:n,opacity:i,fontSize:c.edge.label.fontSize})}),t&&g.has(o.id)&&z.jsx(Me,{prepend:!0,center:!0,position:y,children:t({data:o,onClose:()=>P(o)})})]})};kt.defaultProps={labelPlacement:"inline"};const no=({interpolation:e="linear",arrowPlacement:n="end",labelPlacement:t="inline",animated:o,contextMenu:s,disabled:r,edges:i,labelFontUrl:c,onClick:h,onContextMenu:m,onPointerOut:v,onPointerOver:C})=>{const p=I(O=>O.theme),{getGeometries:x,getGeometry:b}=Qn(n,e),u=I(O=>O.draggingId),f=I(O=>O.edgeMeshes),d=I(O=>O.setEdgeMeshes),y=I(O=>O.actives||[]),g=I(O=>O.selections||[]),[S,E,P,F]=l.useMemo(()=>{const O=[],V=[],D=[],X=[];return i.forEach(Y=>{if(u===Y.source||u===Y.target){g.includes(Y.id)||y.includes(Y.id)?D.push(Y):X.push(Y);return}g.includes(Y.id)||y.includes(Y.id)?O.push(Y):V.push(Y)}),[O,V,D,X]},[i,y,g,u]),_=!!g.length,A=l.useMemo(()=>b(S,E),[b,S,E]),{activeOpacity:N,inactiveOpacity:M}=to(o,_,p);eo(A,o),l.useEffect(()=>{if(u===null){const V=x(i).map(D=>new Se(D));d(V)}},[x,d,i,u]);const G=l.useRef(new Se),k=l.useRef(new Se),T=l.useCallback(O=>{if(!O.camera)return[];const V=O.intersectObjects(f);return V.length?V.map(D=>i[f.indexOf(D.object)]):[]},[f,i]),{handleClick:j,handleContextMenu:a,handleIntersections:R}=Jn({onClick:h,onContextMenu:m,onPointerOut:v,onPointerOver:C},s,r),w=l.useRef(null),L=l.useRef([]);return nt(O=>{if(G.current.geometry=A,r)return;const V=w.current;if((u||u===null&&V!==null)&&(k.current.geometry=b(P,F)),w.current=u,u)return;const D=L.current,X=T(O.raycaster);R(D,X),X.join()!==D.join()&&(k.current.geometry=b(X,[])),L.current=X}),z.jsxs("group",{onClick:j,onContextMenu:a,children:[z.jsxs("mesh",{ref:G,children:[z.jsx(W.meshBasicMaterial,{attach:"material-0",color:p.edge.fill,depthTest:!1,fog:!0,opacity:M,side:ne,transparent:!0}),z.jsx(W.meshBasicMaterial,{attach:"material-1",color:p.edge.activeFill,depthTest:!1,fog:!0,opacity:N,side:ne,transparent:!0})]}),z.jsxs("mesh",{ref:k,children:[z.jsx(W.meshBasicMaterial,{attach:"material-0",color:p.edge.fill,depthTest:!1,fog:!0,opacity:M,side:ne,transparent:!0}),z.jsx(W.meshBasicMaterial,{attach:"material-1",color:p.edge.activeFill,depthTest:!1,fog:!0,opacity:N,side:ne,transparent:!0})]}),i.map(O=>z.jsx(kt,{animated:o,contextMenu:s,color:p.edge.label.color,disabled:r,edge:O,labelFontUrl:c,labelPlacement:t},O.id))]})},Lt=({animated:e,position:n,padding:t,labelFontUrl:o,disabled:s,radius:r,nodes:i,label:c,onClick:h,onPointerOver:m,onPointerOut:v})=>{var C,p,x,b,u;const f=I(w=>w.theme),d=Math.max(n.width,n.height)/2,y=d-r+t,[g,S]=l.useState(!1),E=I(w=>w.centerPosition),P=I(w=>{var L;return(L=w.actives)==null?void 0:L.some(O=>i.some(V=>V.id===O))}),F=I(w=>{var L;return(L=w.selections)==null?void 0:L.some(O=>i.some(V=>V.id===O))}),A=I(w=>{var L;return((L=w.selections)==null?void 0:L.length)>0})?F||g||P?(C=f.cluster)==null?void 0:C.selectedOpacity:(p=f.cluster)==null?void 0:p.inactiveOpacity:(x=f.cluster)==null?void 0:x.opacity,{circleOpacity:N,circlePosition:M,labelPosition:G}=J({from:{circlePosition:[E.x,E.y,-1],circleOpacity:0,labelPosition:[0,-y,2]},to:{labelPosition:[0,-y,2],circlePosition:n?[n.x,n.y,-1]:[0,0,-1],circleOpacity:A},config:{...ee,duration:e?void 0:0}}),k=l.useMemo(()=>{var w;return new se((w=f.cluster)==null?void 0:w.stroke)},[(b=f.cluster)==null?void 0:b.stroke]),T=l.useMemo(()=>{var w;return new se((w=f.cluster)==null?void 0:w.fill)},[(u=f.cluster)==null?void 0:u.fill]);de(g&&h!==void 0,"pointer");const{pointerOver:j,pointerOut:a}=Ae({disabled:s,onPointerOver:()=>{S(!0),m==null||m({nodes:i,label:c})},onPointerOut:()=>{S(!1),v==null||v({nodes:i,label:c})}});return l.useMemo(()=>{var w,L,O;return f.cluster&&z.jsxs(W.group,{position:M,onPointerOver:j,onPointerOut:a,onClick:()=>{s||h==null||h({nodes:i,label:c})},children:[z.jsxs("mesh",{children:[z.jsx("ringGeometry",{attach:"geometry",args:[y,0,128]}),z.jsx(W.meshBasicMaterial,{attach:"material",color:T,transparent:!0,depthTest:!1,opacity:(w=f.cluster)!=null&&w.fill?N:0,side:ne,fog:!0})]}),z.jsxs("mesh",{children:[z.jsx("ringGeometry",{attach:"geometry",args:[y,d+t,128]}),z.jsx(W.meshBasicMaterial,{attach:"material",color:k,transparent:!0,depthTest:!1,opacity:N,side:ne,fog:!0})]}),((L=f.cluster)==null?void 0:L.label)&&z.jsx(W.group,{position:G,children:z.jsx(ce,{text:c,opacity:A,fontUrl:o,stroke:f.cluster.label.stroke,active:!1,color:(O=f.cluster)==null?void 0:O.label.color,fontSize:12})})]})},[f.cluster,M,j,a,y,T,N,d,t,k,G,c,A,o,s,h,i])};Lt.defaultProps={radius:2,padding:40};const Mt=l.forwardRef(({onNodeClick:e,onNodeDoubleClick:n,onNodeContextMenu:t,onEdgeContextMenu:o,onEdgeClick:s,onEdgePointerOver:r,onEdgePointerOut:i,onNodePointerOver:c,onNodePointerOut:h,onClusterClick:m,onNodeDragged:v,onClusterPointerOver:C,onClusterPointerOut:p,contextMenu:x,animated:b,disabled:u,draggable:f,edgeLabelPosition:d,edgeArrowPosition:y,edgeInterpolation:g,labelFontUrl:S,renderNode:E,...P},F)=>{const{layoutType:_,clusterAttribute:A}=P,N=$(D=>D.gl),M=$(D=>D.scene),G=$(D=>D.camera);if(Kn(P),A&&!(_==="forceDirected2d"||_==="forceDirected3d"))throw new Error("Clustering is only supported for the force directed layouts.");const k=I(D=>D.graph),T=I(D=>D.nodes),j=I(D=>D.edges),a=I(D=>[...D.clusters.values()]),{centerNodesById:R,isCentered:w}=qn({animated:b,disabled:u,layoutType:_});l.useImperativeHandle(F,()=>({centerGraph:R,graph:k,renderScene:()=>N.render(M,G)}),[R,k,N,M,G]);const L=l.useMemo(()=>T.map(D=>z.jsx(St,{id:D==null?void 0:D.id,labelFontUrl:S,draggable:f,disabled:u,animated:b,contextMenu:x,renderNode:E,onClick:e,onDoubleClick:n,onContextMenu:t,onPointerOver:c,onPointerOut:h,onDragged:v},D==null?void 0:D.id)),[b,x,u,f,S,T,e,t,n,v,h,c,E]),O=l.useMemo(()=>b?j.map(D=>z.jsx(It,{id:D.id,disabled:u,animated:b,labelFontUrl:S,labelPlacement:d,arrowPlacement:y,interpolation:g,contextMenu:x,onClick:s,onContextMenu:o,onPointerOver:r,onPointerOut:i},D.id)):z.jsx(no,{edges:j,disabled:u,animated:b,labelFontUrl:S,labelPlacement:d,arrowPlacement:y,interpolation:g,contextMenu:x,onClick:s,onContextMenu:o,onPointerOver:r,onPointerOut:i}),[b,x,u,y,g,d,j,S,s,o,i,r]),V=l.useMemo(()=>a.map(D=>z.jsx(Lt,{animated:b,disabled:u,labelFontUrl:S,onClick:m,onPointerOver:C,onPointerOut:p,...D},D.label)),[b,a,u,S,m,p,C]);return w&&z.jsxs(l.Fragment,{children:[L,O,V]})});Mt.defaultProps={edgeInterpolation:"linear"};const oo={canvas:{background:"#fff"},node:{fill:"#7CA0AB",activeFill:"#1DE9AC",opacity:1,selectedOpacity:1,inactiveOpacity:.2,label:{color:"#2A6475",stroke:"#fff",activeColor:"#1DE9AC"},subLabel:{color:"#ddd",stroke:"transparent",activeColor:"#1DE9AC"}},lasso:{border:"1px solid #55aaff",background:"rgba(75, 160, 255, 0.1)"},ring:{fill:"#D8E6EA",activeFill:"#1DE9AC"},edge:{fill:"#D8E6EA",activeFill:"#1DE9AC",opacity:1,selectedOpacity:1,inactiveOpacity:.1,label:{stroke:"#fff",color:"#2A6475",activeColor:"#1DE9AC",fontSize:6}},arrow:{fill:"#D8E6EA",activeFill:"#1DE9AC"},cluster:{stroke:"#D8E6EA",opacity:1,selectedOpacity:1,inactiveOpacity:.1,label:{stroke:"#fff",color:"#2A6475"}}};function xe(e,n,t){const{offsetX:o,offsetY:s}=e,{width:r,height:i}=t;n.set(o/r*2-1,-(s/i)*2+1)}function ro(e){const n=document.createElement("div");return n.style.pointerEvents="none",n.style.border=e.lasso.border,n.style.backgroundColor=e.lasso.background,n.style.position="fixed",n}const so=({children:e,type:n="none",onLasso:t,onLassoEnd:o,disabled:s})=>{var r;const i=I(k=>k.theme),c=$(k=>k.camera),h=$(k=>k.gl),m=$(k=>k.setEvents),v=$(k=>k.size),C=$(k=>k.get),p=$(k=>k.scene),x=Pe(),b=I(k=>k.actives),u=I(k=>k.setActives),f=I(k=>k.edges),d=I(k=>k.edgeMeshes),y=l.useRef(!1),g=l.useRef(null),S=l.useRef(null),E=l.useRef(ro(i)),P=l.useRef(null),F=l.useRef(!1),_=l.useRef(C().events.enabled),A=l.useRef((r=x.controls)==null?void 0:r.enabled);l.useEffect(()=>{y.current&&(t==null||t(b)),y.current=!0},[b,t]);const N=l.useCallback(k=>{if(F.current){const[T,j,a]=P.current;a.x=Math.max(T.x,k.clientX),a.y=Math.max(T.y,k.clientY),j.x=Math.min(T.x,k.clientX),j.y=Math.min(T.y,k.clientY),E.current.style.left=`${j.x}px`,E.current.style.top=`${j.y}px`,E.current.style.width=`${a.x-j.x}px`,E.current.style.height=`${a.y-j.y}px`,xe(k,g.current.endPoint,v),xe(k,S.current.endPoint,v);const R=[],w=S.current.select().sort(O=>O.uuid).map(O=>f[d.indexOf(O)].id);R.push(...w);const L=g.current.select().sort(O=>O.uuid).filter(O=>{var V,D;return O.isMesh&&((V=O.userData)==null?void 0:V.id)&&(((D=O.userData)==null?void 0:D.type)===n||n==="all")}).map(O=>O.userData.id);R.push(...L),requestAnimationFrame(()=>{u(R)}),document.addEventListener("pointermove",N,{passive:!0,capture:!0,once:!0})}},[f,d,u,v,n]),M=l.useCallback(()=>{var k;F.current&&(m({enabled:_.current}),F.current=!1,(k=E.current.parentElement)==null||k.removeChild(E.current),x.controls.enabled=A.current,o==null||o(b),document.removeEventListener("pointermove",N),document.removeEventListener("pointerup",M))},[m,x.controls,o,b,N]),G=l.useCallback(k=>{var T,j;if(k.shiftKey){_.current=C().events.enabled,A.current=(T=x.controls)==null?void 0:T.enabled,g.current=new Te(c,p);const a=new Ht;d.length&&a.add(...d),S.current=new Te(c,a),P.current=[new ue,new ue,new ue];const[R]=P.current;x.controls.enabled=!1,m({enabled:!1}),F.current=!0,(j=h.domElement.parentElement)==null||j.appendChild(E.current),E.current.style.left=`${k.clientX}px`,E.current.style.top=`${k.clientY}px`,E.current.style.width="0px",E.current.style.height="0px",R.x=k.clientX,R.y=k.clientY,xe(k,g.current.startPoint,v),xe(k,S.current.startPoint,v),document.addEventListener("pointermove",N,{passive:!0,capture:!0,once:!0}),document.addEventListener("pointerup",M,{passive:!0})}},[c,x.controls,d,C,h.domElement.parentElement,N,M,p,m,v]);return l.useEffect(()=>{if(!(s||n==="none"))return typeof window<"u"&&(document.addEventListener("pointerdown",G,{passive:!0}),document.addEventListener("pointermove",N,{passive:!0}),document.addEventListener("pointerup",M,{passive:!0})),()=>{typeof window<"u"&&(document.removeEventListener("pointerdown",G),document.removeEventListener("pointermove",N),document.removeEventListener("pointerup",M))}},[n,s,G,N,M]),z.jsx("group",{children:e})},io="_canvas_670zp_1",co={canvas:io},ao={alpha:!0,antialias:!0},lo={position:[0,0,1e3],near:5,far:5e4,fov:10},uo=l.forwardRef(({cameraMode:e,edges:n,children:t,nodes:o,theme:s,onCanvasClick:r,animated:i,disabled:c,lassoType:h,onLasso:m,onLassoEnd:v,glOptions:C,...p},x)=>{var b,u;const f=l.useRef(null),d=l.useRef(null),y=l.useRef(null);l.useImperativeHandle(x,()=>({centerGraph:_=>{var A;return(A=f.current)==null?void 0:A.centerGraph(_)},zoomIn:()=>{var _;return(_=d.current)==null?void 0:_.zoomIn()},zoomOut:()=>{var _;return(_=d.current)==null?void 0:_.zoomOut()},panLeft:()=>{var _;return(_=d.current)==null?void 0:_.panLeft()},panRight:()=>{var _;return(_=d.current)==null?void 0:_.panRight()},panDown:()=>{var _;return(_=d.current)==null?void 0:_.panDown()},panUp:()=>{var _;return(_=d.current)==null?void 0:_.panUp()},resetControls:_=>{var A;return(A=d.current)==null?void 0:A.resetControls(_)},getControls:()=>{var _;return(_=d.current)==null?void 0:_.controls},getGraph:()=>{var _;return(_=f.current)==null?void 0:_.graph},exportCanvas:()=>(f.current.renderScene(),y.current.toDataURL())}));const{selections:g,actives:S,collapsedNodeIds:E}=p,P=n.length+o.length>400?!1:i,F=l.useMemo(()=>({...C,...ao}),[C]);return z.jsx("div",{className:co.canvas,children:z.jsx(Ut,{legacy:!0,linear:!0,ref:y,flat:!0,gl:F,camera:lo,onPointerMissed:r,children:z.jsxs(Hn,{createStore:()=>Yn({selections:g,actives:S,theme:s,collapsedNodeIds:E}),children:[((b=s.canvas)==null?void 0:b.background)&&z.jsx("color",{attach:"background",args:[s.canvas.background]}),z.jsx("ambientLight",{intensity:1}),t,((u=s.canvas)==null?void 0:u.fog)&&z.jsx("fog",{attach:"fog",args:[s.canvas.fog,4e3,9e3]}),z.jsx(_t,{mode:e,ref:d,disabled:c,animated:i,children:z.jsx(so,{disabled:c,type:h,onLasso:m,onLassoEnd:v,children:z.jsx(l.Suspense,{children:z.jsx(Mt,{ref:f,disabled:c,animated:P,edges:n,nodes:o,...p})})})})]})})})});uo.defaultProps={cameraMode:"pan",layoutType:"forceDirected2d",sizingType:"default",labelType:"auto",theme:oo,animated:!0,defaultNodeSize:7,minNodeSize:5,maxNodeSize:15,lassoType:"none",glOptions:{}};export{uo as G};
