import{u as Dt,r as a,C as q,R as Pt,S as jt,B as nt,i as Tt,M as Gt,Q as ot,V as Vt,j as W,k as ue,l as Ft,m as Re,n as Bt,K as Ee,o as $,p as st,q as Ne,s as O,t as Ut,v as Yt,w as ee,x as de,y as K,H as Le,E as rt,z as ke,D as ne,A as re,F as Te,G as Ht,P as Kt,I as Wt,T as Xt,L as $t,J as Zt,N as it,O as qt,U as Qt,W as Jt,X as Oe,Y as en,Z as ye,$ as tn,a0 as Ie,a1 as Me,a2 as ct,a3 as at,a4 as lt,a5 as nn,a6 as ut,a7 as on,a8 as sn,a9 as rn,aa as dt,ab as cn,ac as an,ad as ln,ae as un,af as dn,ag as fn,ah as gn,ai as pn,aj as vn,ak as hn}from"./vendor-BP-3K6eZ.js";const mn={},Ge=e=>{let o;const t=new Set,n=(p,v)=>{const g=typeof p=="function"?p(o):p;if(!Object.is(g,o)){const _=o;o=v??typeof g!="object"?g:Object.assign({},o,g),t.forEach(h=>h(o,_))}},r=()=>o,c={setState:n,getState:r,subscribe:p=>(t.add(p),()=>t.delete(p)),destroy:()=>{(mn?"staging":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),t.clear()}};return o=e(n,r,c),c},yn=e=>e?Ge(e):Ge,bn={},{useSyncExternalStoreWithSelector:xn}=Dt;function ft(e,o=e.getState,t){const n=xn(e.subscribe,e.getState,e.getServerState||e.getState,o,t);return a.useDebugValue(n),n}const Ve=e=>{(bn?"staging":void 0)!=="production"&&typeof e!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const o=typeof e=="function"?yn(e):e,t=(n,r)=>ft(o,n,r);return Object.assign(t,o),t},En=e=>e?Ve(e):Ve,Cn={};function wn(){(Cn?"staging":void 0)!=="production"&&console.warn("[DEPRECATED] `context` will be removed in a future version. Instead use `import { createStore, useStore } from 'zustand'`. See: https://github.com/pmndrs/zustand/discussions/1180.");const e=a.createContext(void 0);return{Provider:({createStore:r,children:s})=>{const i=a.useRef();return i.current||(i.current=r()),a.createElement(e.Provider,{value:i.current},s)},useStore:(r,s)=>{const i=a.useContext(e);if(!i)throw new Error("Seems like you have not used zustand provider as an ancestor.");return ft(i,r,s)},useStoreApi:()=>{const r=a.useContext(e);if(!r)throw new Error("Seems like you have not used zustand provider as an ancestor.");return a.useMemo(()=>({...r}),[r])}}}(function(){try{if(typeof document<"u"){var e=document.createElement("style");e.appendChild(document.createTextNode(`._canvas_670zp_1 {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
}
._container_155l7_1 {
  transform-origin: bottom right;
  overflow: hidden;
  position: absolute;
  border: solid 1px var(--radial-menu-border);
}

  ._container_155l7_1._disabled_155l7_7 {
    opacity: 0.6;
  }

  ._container_155l7_1._disabled_155l7_7 ._contentContainer_155l7_10 {
      cursor: not-allowed;
    }

  ._container_155l7_1:not(._disabled_155l7_7) ._contentContainer_155l7_10 {
      cursor: pointer;
    }

  ._container_155l7_1:not(._disabled_155l7_7) ._contentContainer_155l7_10:hover {
        color: var(--radial-menu-active-color);
        background: var(--radial-menu-active-background);
      }

  ._container_155l7_1 ._contentContainer_155l7_10 {
    width: 200%;
    height: 200%;
    transform-origin: 50% 50%;
    border-radius: 50%;
    outline: none;
    transition: background 150ms ease-in-out;
    color: var(--radial-menu-color);
  }

  ._container_155l7_1 ._contentContainer_155l7_10 ._contentInner_155l7_35 {
      position: absolute;
      width: 100%;
      text-align: center;
    }

  ._container_155l7_1 ._contentContainer_155l7_10 ._contentInner_155l7_35 ._content_155l7_10 {
        display: inline-block;
      }

  ._container_155l7_1 svg {
    margin: 0 auto;
    fill: var(--radial-menu-active-color);
    height: 25px;
    width: 25px;
    display: block;
  }
._container_x9hyx_1 {
  border-radius: 50%;
  z-index: 9;
  position: relative;
  height: 175px;
  width: 175px;
  border: solid 5px var(--radial-menu-border);
  overflow: hidden;
  background: var(--radial-menu-background);
}

  ._container_x9hyx_1:before {
    content: ' ';
    background: var(--radial-menu-border);
    border-radius: 50%;
    height: 25px;
    width: 25px;
    position: absolute;
    z-index: 9;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
  }`)),document.head.appendChild(e)}}catch(o){console.error("vite-plugin-css-injected-by-js",o)}})();var Fe,Be;function gt(e,o=[]){const t=o.length;for(const n of e){const r=o.indexOf(n);if(r>-1){const s=[...o.slice(r),n].map(i=>i.data.id);throw new Error(`Invalid Graph: Circular node path detected: ${s.join(" -> ")}.`)}t>n.depth&&(n.depth=t,gt(n.out,[...o,n]))}}function pt(e,o){let t=!1;const n=e.reduce((i,c)=>({...i,[c.id]:{data:c,out:[],depth:-1,ins:[]}}),{});try{for(const i of o){const c=i.source,p=i.target;if(!n.hasOwnProperty(c))throw new Error(`Missing source Node ${c}`);if(!n.hasOwnProperty(p))throw new Error(`Missing target Node ${p}`);const v=n[c],g=n[p];g.ins.push(v),v.out.push(g)}gt(Object.values(n))}catch{t=!0}const r=Object.keys(n).map(i=>n[i].depth),s=Math.max(...r);return{invalid:t,depths:n,maxDepth:s||1}}const Ue=["radialin","radialout"];function _n({nodes:e,edges:o,mode:t="lr",nodeLevelRatio:n=2}){const{depths:r,maxDepth:s,invalid:i}=pt(e,o);if(i)return null;const c=Ue.includes(t)?1:5,p=e.length/s*n*c;if(t){const v=(E,x)=>u=>E?(r[u.id].depth-s/2)*p*(x?-1:1):void 0,g=v(["lr","rl"].includes(t),t==="rl"),_=v(["td","bu"].includes(t),t==="td"),h=v(["zin","zout"].includes(t),t==="zout");e.forEach(E=>{E.fx=g(E),E.fy=_(E),E.fz=h(E)})}return Ue.includes(t)?dn(v=>{const g=r[v.id];return(t==="radialin"?s-g.depth:g.depth)*p}).strength(1):null}function zn(e){return new Promise((o,t)=>{let n;function r(){n?o(n):(n=e.step(),r())}r()})}function pe(e){const o=[],t=[];return e.forEachNode((n,r)=>{o.push({...r,id:n,radius:r.size||1})}),e.forEachEdge((n,r)=>{t.push({...r,id:n})}),{nodes:o,edges:t}}function kn(){const e=l=>()=>l;let t=l=>l.index,n=[],r=[],s,i=[100,100],c=e(1),p=e(-1),v=e(100),g=e(.1),_={},h=.1,E=.001,x=[],u=[0,0],f,d=l=>l.cluster,b="treemap",y=!0,R=.1;function w(l){if(!y)return w;b==="force"&&(f.tick(),V());for(let m=0,C=n.length,k,S=l*R;m<C;++m)k=n[m],k.vx+=(_[d(k)].x-k.x)*S,k.vy+=(_[d(k)].y-k.y)*S}function N(){n&&(b==="treemap"?I():G())}w.initialize=function(l){n=l,N()};function F(l){let m=d(l.source),C=d(l.target);return m<=C?m+"~"+C:C+"~"+m}function z(l){let m=new Map,C={};return l.forEach(function(k){m.has(d(k))||m.set(d(k),{count:0,sumforceNodeSize:0})}),l.forEach(function(k){C=m.get(d(k)),C.count=C.count+1,C.sumforceNodeSize=C.sumforceNodeSize+Math.PI*(c(k)*c(k))*1.3,m.set(d(k),C)}),m}function D(l){let m=new Map,C=[];return l.forEach(function(k){let S=F(k),T;m.has(S)?T=m.get(S):T=0,T+=1,m.set(S,T)}),m.forEach(function(k,S){let T,L;T=S.split("~")[0],L=S.split("~")[1],T!==void 0&&L!==void 0&&C.push({source:T,target:L,count:k})}),C}function P(){let l=[],m=[],C=new Map,k,S,T,L,X;L=z(n),X=D(r);for(k of L.keys())T=L.get(k),l.push({id:k,size:T.count,r:Math.sqrt(T.sumforceNodeSize/Math.PI)}),C.set(k,S);return X.forEach(function(H){let Q=C.get(H.source),J=C.get(H.target);Q!==void 0&&J!==void 0&&m.push({source:Q,target:J,count:H.count})}),{nodes:l,links:m}}function A(){let l=[],m,C,k;k=z(w.nodes());for(m of k.keys())C=k.get(m),l.push({id:m,size:C.count});return{id:"clustersTree",children:l}}function V(){return _.none={x:0,y:0},x.forEach(function(l){b==="treemap"?_[l.data.id]={x:l.x0+(l.x1-l.x0)/2-u[0],y:l.y0+(l.y1-l.y0)/2-u[1]}:_[l.id]={x:l.x-u[0],y:l.y-u[1]}}),_}function I(){let l=pn().size(w.size());s=dt(A()).sum(m=>m.radius).sort(function(m,C){return C.height-m.height||C.value-m.value}),x=l(s).leaves(),V()}function j(){let l=0;n.length!==0&&r.forEach(function(m){let C,k;if(n){if(C=m.source,k=m.target,typeof m.source!="object"&&(C=n.find(S=>S.id===m.source)),typeof m.target!="object"&&(k=n.find(S=>S.id===m.target)),C===void 0||k===void 0)throw Error("Error setting links, couldnt find nodes for a link (see it on the console)");m.source=C,m.target=k,m.index=l++}})}function G(){let l;!n||!n.length||(j(),l=P(),f=ct(l.nodes).force("x",Ie(i[0]/2).strength(.1)).force("y",Me(i[1]/2).strength(.1)).force("collide",ut(m=>m.r).iterations(4)).force("charge",lt().strength(p)).force("links",at(l.nodes.length?l.links:[]).distance(v).strength(g)),x=f.nodes(),V())}return w.template=function(l){return arguments.length?(b=l,N(),w):b},w.groupBy=function(l){return arguments.length?typeof l=="string"?(d=function(m){return m[l]},w):(d=l,w):d},w.enableGrouping=function(l){return arguments.length?(y=l,w):y},w.strength=function(l){return arguments.length?(R=l,w):R},w.getLinkStrength=function(l){return y?d(l.source)===d(l.target)?typeof h=="function"?h(l):h:typeof E=="function"?E(l):E:typeof h=="function"?h(l):h},w.id=function(l){return arguments.length?(t=l,w):t},w.size=function(l){return arguments.length?(i=l,w):i},w.linkStrengthInterCluster=function(l){return arguments.length?(E=l,w):E},w.linkStrengthIntraCluster=function(l){return arguments.length?(h=l,w):h},w.nodes=function(l){return arguments.length?(n=l,w):n},w.links=function(l){return arguments.length?(l===null?r=[]:r=l,N(),w):r},w.template=function(l){return arguments.length?(b=l,N(),w):b},w.forceNodeSize=function(l){return arguments.length?(c=typeof l=="function"?l:e(+l),N(),w):c},w.nodeSize=w.forceNodeSize,w.forceCharge=function(l){return arguments.length?(p=typeof l=="function"?l:e(+l),N(),w):p},w.forceLinkDistance=function(l){return arguments.length?(v=typeof l=="function"?l:e(+l),N(),w):v},w.forceLinkStrength=function(l){return arguments.length?(g=typeof l=="function"?l:e(+l),N(),w):g},w.offset=function(l){return arguments.length?(u=typeof l=="function"?l:e(+l),w):u},w.getFocis=V,w}function se({graph:e,nodeLevelRatio:o=2,mode:t=null,dimensions:n=2,nodeStrength:r=-250,linkDistance:s=50,clusterStrength:i=.5,linkStrengthInterCluster:c=.01,linkStrengthIntraCluster:p=.5,forceLinkDistance:v=100,forceLinkStrength:g=.1,clusterType:_="force",forceCharge:h=-700,getNodePosition:E,drags:x,clusterAttribute:u,forceLayout:f}){const{nodes:d,edges:b}=pe(e),R=n===2&&b.length>25?r*2:r;let w,N;f==="forceDirected2d"?(w=Ie(),N=Me()):(w=Ie(600).strength(.05),N=Me(600).strength(.05));const F=ct().force("link",at()).force("charge",lt().strength(R)).force("x",w).force("y",N).force("z",nn()).force("collide",ut(A=>A.radius+10)).force("dagRadial",_n({nodes:d,edges:b,mode:t,nodeLevelRatio:o})).stop();let z;if(u){let A=h;if(d!=null&&d.length){const V=Math.ceil(d.length/200);A=h*V}z=kn().strength(i).template(_).groupBy(V=>V.data[u]).links(b).size([100,100]).linkStrengthInterCluster(c).linkStrengthIntraCluster(p).forceLinkDistance(v).forceLinkStrength(g).forceCharge(A).forceNodeSize(V=>V.radius)}let D=F.numDimensions(n).nodes(d);if(z&&(D=D.force("group",z)),s){let A=D.force("link");A&&(A.id(V=>V.id).links(b).distance(s),z&&(A=A.strength((z==null?void 0:z.getLinkStrength)??.1)))}const P=new Map(d.map(A=>[A.id,A]));return{step(){for(;F.alpha()>.01;)F.tick();return!0},getNodePosition(A){var V,I;if(E){const j=E(A,{graph:e,drags:x,nodes:d,edges:b});if(j)return j}return(V=x==null?void 0:x[A])!=null&&V.position?(I=x==null?void 0:x[A])==null?void 0:I.position:P.get(A)}}}function Sn({graph:e,radius:o,drags:t,getNodePosition:n}){const r=on(e,{scale:o}),{nodes:s,edges:i}=pe(e);return{step(){return!0},getNodePosition(c){var p,v;if(n){const g=n(c,{graph:e,drags:t,nodes:s,edges:i});if(g)return g}return(p=t==null?void 0:t[c])!=null&&p.position?(v=t==null?void 0:t[c])==null?void 0:v.position:r==null?void 0:r[c]}}}const Rn={td:{x:"x",y:"y",factor:-1},lr:{x:"y",y:"x",factor:1}};function Ye({graph:e,drags:o,mode:t="td",nodeSeparation:n=1,nodeSize:r=[50,50],getNodePosition:s}){const{nodes:i,edges:c}=pe(e),{depths:p}=pt(i,c),v=Object.keys(p).map(u=>p[u]),g=sn().id(u=>u.data.id).parentId(u=>{var f,d,b;return(b=(d=(f=u.ins)==null?void 0:f[0])==null?void 0:d.data)==null?void 0:b.id})(v),h=rn().separation(()=>n).nodeSize(r)(dt(g)).descendants(),E=Rn[t],x=new Map(i.map(u=>{const{x:f,y:d}=h.find(b=>b.data.id===u.id);return[u.id,{...u,[E.x]:f*E.factor,[E.y]:d*E.factor,z:0}]}));return{step(){return!0},getNodePosition(u){var f,d;if(s){const b=s(u,{graph:e,drags:o,nodes:i,edges:c});if(b)return b}return(f=o==null?void 0:o[u])!=null&&f.position?(d=o==null?void 0:o[u])==null?void 0:d.position:x.get(u)}}}function On({graph:e,margin:o,drags:t,getNodePosition:n,ratio:r,gridSize:s,maxIterations:i}){const{nodes:c,edges:p}=pe(e),v=cn(e,{maxIterations:i,inputReducer:(g,_)=>({..._,x:_.x||0,y:_.y||0}),settings:{ratio:r,margin:o,gridSize:s}});return{step(){return!0},getNodePosition(g){var _,h;if(n){const E=n(g,{graph:e,drags:t,nodes:c,edges:p});if(E)return E}return(_=t==null?void 0:t[g])!=null&&_.position?(h=t==null?void 0:t[g])==null?void 0:h.position:v==null?void 0:v[g]}}}function In({graph:e,drags:o,iterations:t,...n}){an.assign(e);const r=ln(e,{iterations:t,settings:n});return{step(){return!0},getNodePosition(s){var i;return((i=o==null?void 0:o[s])==null?void 0:i.position)||(r==null?void 0:r[s])}}}function Mn({graph:e,drags:o,getNodePosition:t}){const{nodes:n,edges:r}=pe(e);return{step(){return!0},getNodePosition(s){return t(s,{graph:e,drags:o,nodes:n,edges:r})}}}const Nn=["forceDirected2d","treeTd2d","treeLr2d","radialOut2d","treeTd3d","treeLr3d","radialOut3d","forceDirected3d"];function Ln({type:e,...o}){if(Nn.includes(e)){const{nodeStrength:t,linkDistance:n,nodeLevelRatio:r}=o;if(e==="forceDirected2d")return se({...o,dimensions:2,nodeLevelRatio:r||2,nodeStrength:t||-250,linkDistance:n,forceLayout:e});if(e==="treeTd2d")return se({...o,mode:"td",dimensions:2,nodeLevelRatio:r||5,nodeStrength:t||-250,linkDistance:n||50,forceLayout:e});if(e==="treeLr2d")return se({...o,mode:"lr",dimensions:2,nodeLevelRatio:r||5,nodeStrength:t||-250,linkDistance:n||50,forceLayout:e});if(e==="radialOut2d")return se({...o,mode:"radialout",dimensions:2,nodeLevelRatio:r||5,nodeStrength:t||-500,linkDistance:n||100,forceLayout:e});if(e==="treeTd3d")return se({...o,mode:"td",dimensions:3,nodeLevelRatio:r||2,nodeStrength:t||-500,linkDistance:n||50});if(e==="treeLr3d")return se({...o,mode:"lr",dimensions:3,nodeLevelRatio:r||2,nodeStrength:t||-500,linkDistance:n||50,forceLayout:e});if(e==="radialOut3d")return se({...o,mode:"radialout",dimensions:3,nodeLevelRatio:r||2,nodeStrength:t||-500,linkDistance:n||100,forceLayout:e});if(e==="forceDirected3d")return se({...o,dimensions:3,nodeLevelRatio:r||2,nodeStrength:t||-250,linkDistance:n,forceLayout:e})}else if(e==="circular2d"){const{radius:t}=o;return Sn({...o,radius:t||300})}else{if(e==="hierarchicalTd")return Ye({...o,mode:"td"});if(e==="hierarchicalLr")return Ye({...o,mode:"lr"});if(e==="nooverlap"){const{graph:t,maxIterations:n,ratio:r,margin:s,gridSize:i,...c}=o;return On({graph:t,margin:s||10,maxIterations:n||50,ratio:r||10,gridSize:i||20,...c})}else if(e==="forceatlas2"){const{graph:t,iterations:n,gravity:r,scalingRatio:s,...i}=o;return In({type:"forceatlas2",graph:t,...i,scalingRatio:s||100,gravity:r||10,iterations:n||50})}else if(e==="custom")return Mn({...o})}throw new Error(`Layout ${e} not found.`)}const An=20;function vt({nodeCount:e,nodePosition:o,labelType:t,camera:n}){return(r,s)=>{var i;return n&&o&&((i=n==null?void 0:n.position)==null?void 0:i.z)/(n==null?void 0:n.zoom)-(o==null?void 0:o.z)>6e3?!1:t==="all"||t==="nodes"&&r==="node"||t==="edges"&&r==="edge"?!0:t==="auto"&&r==="node"?e<=An?!0:s>7:!1}}function ht(e,o){switch(o){case"above":return e;case"below":return-e;case"inline":case"natural":default:return 0}}function Dn({graph:e}){const o=gn(e);return{ranks:o,getSizeForNode:t=>o[t]*80}}function Pn({graph:e}){const o=fn.degreeCentrality(e);return{ranks:o,getSizeForNode:t=>o[t]*20}}function jn({graph:e,attribute:o,defaultSize:t}){const n=new Map;return o?e.forEachNode((r,s)=>{var i;const c=(i=s.data)==null?void 0:i[o];isNaN(c)&&console.warn(`Attribute ${c} is not a number for node ${s.id}`),n.set(r,c||0)}):console.warn("Attribute sizing configured but no attribute provided"),{getSizeForNode:r=>!o||!n?t:n.get(r)}}const He={pagerank:Dn,centrality:Pn,attribute:jn,none:({defaultSize:e})=>({getSizeForNode:o=>e})};function Tn({type:e,...o}){var t;const n=(t=He[e])==null?void 0:t.call(He,o);if(!n&&e!=="default")throw new Error(`Unknown sizing strategy: ${e}`);const{graph:r,minSize:s,maxSize:i}=o,c=new Map;let p,v;if(r.forEachNode((g,_)=>{let h;e==="default"?h=_.size||o.defaultSize:h=n.getSizeForNode(g),(p===void 0||h<p)&&(p=h),(v===void 0||h>v)&&(v=h),c.set(g,h)}),e!=="none"){const g=un().domain([p,v]).rangeRound([s,i]);for(const[_,h]of c)c.set(_,g(h))}return c}function Gn(e,o,t){e.clear();for(const n of o)try{e.addNode(n.id,n)}catch({message:r}){console.error(`[Graph] ${r}`)}for(const n of t)try{e.addEdge(n.source,n.target,n)}catch({message:r}){console.error(`[Graph] ${r}`)}return e}function Vn({graph:e,layout:o,sizingType:t,labelType:n,sizingAttribute:r,defaultNodeSize:s,minNodeSize:i,maxNodeSize:c}){const p=[],v=[],g=new Map,_=Tn({graph:e,type:t,attribute:r,minSize:i,maxSize:c,defaultSize:s}),h=e.nodes().length,E=vt({nodeCount:h,labelType:n});return e.forEachNode((x,u)=>{const f=o.getNodePosition(x),{data:d,fill:b,icon:y,label:R,size:w,...N}=u,F=_.get(u.id),z=E("node",F),P=(e.inboundNeighbors(u.id)||[]).map(V=>e.getNodeAttributes(V)),A={...u,size:F,labelVisible:z,label:R,icon:y,fill:b,parents:P,data:{...N,...d??{}},position:{...f,x:f.x||0,y:f.y||0,z:f.z||1}};g.set(u.id,A),p.push(A)}),e.forEachEdge((x,u)=>{const f=g.get(u.source),d=g.get(u.target);if(f&&d){const{data:b,id:y,label:R,size:w,...N}=u,F=E("edge",w);v.push({...u,id:y,label:R,labelVisible:F,size:w,data:{...N,id:y,...b||{}}})}}),{nodes:p,edges:v}}const te={mass:10,tension:1e3,friction:300,precision:.1};function mt(e,o,t){const n=o.getLength(),r=e==="end"?n:n/2,s=e==="end"?t/2:0,i=(r-s)/n,c=o.getPointAt(i),p=o.getTangentAt(i);return[c,p]}function yt(e){return[e+6,2+e/1.5]}const Ke=.7;function bt(e,o,t=0){const n=new W(e.x,e.y||0,e.z||0),r=new W(o.x,o.y||0,o.z||0),s=new W().addVectors(n,r).divideScalar(2);return s.setLength(s.length()+t)}function Fn(e,o,t=-1){const n=e.clone(),r=o.clone(),s=new W().subVectors(r,n),i=s.length(),c=s.clone().normalize(),p=new W().subVectors(r,n).divideScalar(2),v=Math.abs(c.x)%1,g=new W(-c.y,c.x-v*c.z,v*c.y).normalize(),_=new W().add(n).add(p).add(g.multiplyScalar(i/4).multiplyScalar(t));return[e,_,o]}function fe(e,o,t,n,r,s){const i=We(e,t,o),c=We(t,e,n);return r?new Qt(...Fn(i,c,s)):new Jt(i,c)}function ge(e){return new W(e.position.x,e.position.y,e.position.z||0)}function We(e,o,t){const n=e.distanceTo(o);return e.clone().add(o.clone().sub(e).multiplyScalar(t/n))}function Xe(e,o){return{...e,position:{...e.position,x:e.position.x+o.x,y:e.position.y+o.y,z:e.position.z+o.z}}}function Bn({edge:e,edges:o,curved:t}){let n=t,r;const s=o.filter(i=>i.target===e.target&&i.source===e.source).map(i=>i.id);if(s.length>1){n=!0;const i=s.indexOf(e.id);s.length===2?r=i===0?Ke:-.7:r=(i-Math.floor(s.length/2))*Ke}return{curved:n,curveOffset:r}}function Ae(e){let o=Number.POSITIVE_INFINITY,t=Number.NEGATIVE_INFINITY,n=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY,s=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY;for(let c of e)o=Math.min(o,c.position.x),t=Math.max(t,c.position.x),n=Math.min(n,c.position.y),r=Math.max(r,c.position.y),s=Math.min(s,c.position.z),i=Math.max(i,c.position.z);return{height:r-n,width:t-o,minX:o,maxX:t,minY:n,maxY:r,minZ:s,maxZ:i,x:(t+o)/2,y:(r+n)/2,z:(i+s)/2}}function Un(e,o){return o?e.reduce((t,n)=>{const r=n.data[o];return r&&t.set(r,[...t.get(r)||[],n]),t},new Map):new Map}function Yn({nodes:e,clusterAttribute:o}){const t=new Map;if(o){const n=Un(e,o);for(const[r,s]of n){const i=Ae(s);t.set(r,{label:r,nodes:s,position:i})}}return t}const De=({sensitivity:e=7,interval:o=50,timeout:t=0,disabled:n,onPointerOver:r,onPointerOut:s})=>{const i=a.useRef(!1),c=a.useRef(null),p=a.useRef(0),v=a.useRef({x:null,y:null,px:null,py:null}),g=a.useCallback(f=>{v.current.x=f.clientX,v.current.y=f.clientY},[]),_=a.useCallback(f=>{c.current=clearTimeout(c.current);const{px:d,x:b,py:y,y:R}=v.current;Math.abs(d-b)+Math.abs(y-R)<e?(p.current=1,r(f)):(v.current.px=b,v.current.py=R,c.current=setTimeout(()=>_(f),o))},[o,r,e]),h=a.useCallback(()=>{clearTimeout(c.current),typeof window<"u"&&document.removeEventListener("mousemove",g,!1)},[g]),E=a.useCallback(f=>{n||(i.current=!0,h(),p.current!==1&&(v.current.px=f.pointer.x,v.current.py=f.pointer.y,typeof window<"u"&&document.addEventListener("mousemove",g,!1),c.current=setTimeout(()=>_(f),t)))},[h,_,n,g,t]),x=a.useCallback(f=>{c.current=clearTimeout(c.current),p.current=0,s(f)},[s]),u=a.useCallback(f=>{i.current=!1,h(),p.current===1&&(c.current=setTimeout(()=>x(f),t))},[h,x,t]);return{pointerOver:E,pointerOut:u}},Hn=({draggable:e,set:o,position:t,onDragStart:n,onDragEnd:r})=>{const s=$(u=>u.camera),i=$(u=>u.raycaster),c=$(u=>u.size),p=$(u=>u.gl),{mouse2D:v,mouse3D:g,offset:_,normal:h,plane:E}=a.useMemo(()=>({mouse2D:new ue,mouse3D:new W,offset:new W,normal:new W,plane:new Kt}),[]),x=a.useMemo(()=>p.domElement.getBoundingClientRect(),[p.domElement]);return Wt({onDragStart:({event:u})=>{const{eventObject:f,point:d}=u;f.getWorldPosition(_).sub(d),g.copy(d),n()},onDrag:({event:u})=>{const f=(u.clientX-((x==null?void 0:x.left)??0))/c.width*2-1,d=-((u.clientY-((x==null?void 0:x.top)??0))/c.height)*2+1;v.set(f,d),i.setFromCamera(v,s),s.getWorldDirection(h).negate(),E.setFromNormalAndCoplanarPoint(h,g),i.ray.intersectPlane(E,g);const b=new W(t.x,t.y,t.z).copy(g).add(_);return o(b)},onDragEnd:r},{drag:{enabled:e,threshold:10}})};function Kn(e,o,t){return vn.bidirectional(e,o,t)}const{Provider:Wn,useStore:M}=wn(),Xn=({actives:e=[],selections:o=[],collapsedNodeIds:t=[],theme:n})=>En(r=>({theme:{...n,edge:{...n.edge,label:{...n.edge.label,fontSize:n.edge.label.fontSize??6}}},edges:[],nodes:[],collapsedNodeIds:t,clusters:new Map,panning:!1,draggingId:null,actives:e,edgeContextMenus:new Set,edgeMeshes:[],selections:o,drags:{},graph:new hn({multi:!0}),setTheme:s=>r(i=>({...i,theme:s})),setClusters:s=>r(i=>({...i,clusters:s})),setEdgeContextMenus:s=>r(i=>({...i,edgeContextMenus:s})),setEdgeMeshes:s=>r(i=>({...i,edgeMeshes:s})),setPanning:s=>r(i=>({...i,panning:s})),setDrags:s=>r(i=>({...i,drags:s})),setDraggingId:s=>r(i=>({...i,draggingId:s})),setActives:s=>r(i=>({...i,actives:s})),setSelections:s=>r(i=>({...i,selections:s})),setNodes:s=>r(i=>({...i,nodes:s,centerPosition:Ae(s)})),setEdges:s=>r(i=>({...i,edges:s})),setNodePosition:(s,i)=>r(c=>{var p,v;const g=c.nodes.find(u=>u.id===s),_=ge(g),E=new W(i.x,i.y,i.z).sub(_),x=[...c.nodes];if((p=c.selections)!=null&&p.includes(s))(v=c.selections)==null||v.forEach(u=>{const f=c.nodes.find(d=>d.id===u);if(f){const d=c.nodes.indexOf(f);x[d]=Xe(f,E)}});else{const u=c.nodes.indexOf(g);x[u]=Xe(g,E)}return{...c,drags:{...c.drags,[s]:g},nodes:x}}),setCollapsedNodeIds:(s=[])=>r(i=>({...i,collapsedNodeIds:s}))}));function xt({nodeId:e,nodes:o,edges:t,currentHiddenNodes:n,currentHiddenEdges:r}){const s=[],i=[],c=n.map(E=>E.id),p=r.map(E=>E.id),v=t.filter(E=>E.source===e),g=v.map(E=>E.target);i.push(...v);for(const E of g){const x=t.filter(f=>f.target===E&&f.source!==e);let u=!1;if((x.length===0||x.length>0&&!c.includes(E)&&x.map(d=>d.id).every(d=>p.includes(d)))&&(u=!0),u){const f=o.find(b=>b.id===E);f&&s.push(f);const d=xt({nodeId:E,nodes:o,edges:t,currentHiddenEdges:i,currentHiddenNodes:s});i.push(...d.hiddenEdges),s.push(...d.hiddenNodes)}}const _=Object.values(i.reduce((E,x)=>({...E,[x.id]:x}),{})),h=Object.values(s.reduce((E,x)=>({...E,[x.id]:x}),{}));return{hiddenEdges:_,hiddenNodes:h}}const $n=({collapsedIds:e,nodes:o,edges:t})=>{const n=[],r=[];for(const v of e){const{hiddenEdges:g,hiddenNodes:_}=xt({nodeId:v,nodes:o,edges:t,currentHiddenEdges:r,currentHiddenNodes:n});n.push(..._),r.push(...g)}const s=n.map(v=>v.id),i=r.map(v=>v.id),c=o.filter(v=>!s.includes(v.id)),p=t.filter(v=>!i.includes(v.id));return{visibleNodes:c,visibleEdges:p}},Zn=({layoutType:e,sizingType:o,labelType:t,sizingAttribute:n,clusterAttribute:r,selections:s,nodes:i,edges:c,actives:p,collapsedNodeIds:v,defaultNodeSize:g,maxNodeSize:_,minNodeSize:h,layoutOverrides:E})=>{const x=M(l=>l.graph),u=M(l=>l.setClusters),f=M(l=>l.collapsedNodeIds),d=M(l=>l.setEdges),b=M(l=>l.nodes),y=M(l=>l.setNodes),R=M(l=>l.setSelections),w=M(l=>l.setActives),N=M(l=>l.drags),F=M(l=>l.setDrags),z=M(l=>l.setCollapsedNodeIds),D=a.useRef(!1),P=a.useRef(null),A=$(l=>l.camera),{visibleEdges:V,visibleNodes:I}=a.useMemo(()=>$n({collapsedIds:f,nodes:i,edges:c}),[f,i,c]),j=a.useRef(N);a.useEffect(()=>{j.current=N},[N]);const G=a.useCallback(async l=>{P.current=l||Ln({...E,type:e,graph:x,drags:j.current,clusterAttribute:r}),await zn(P.current);const m=Vn({graph:x,layout:P.current,sizingType:o,labelType:t,sizingAttribute:n,maxNodeSize:_,minNodeSize:h,defaultNodeSize:g}),C=Yn({nodes:m.nodes,clusterAttribute:r});d(m.edges),y(m.nodes),u(C)},[E,e,r,o,t,n,_,h,g,d,y,u]);a.useEffect(()=>{const l=b.map(C=>({...C,labelVisible:vt({nodeCount:b==null?void 0:b.length,labelType:t,camera:A,nodePosition:C==null?void 0:C.position})("node",C==null?void 0:C.size)}));l.some((C,k)=>C.labelVisible!==b[k].labelVisible)&&y(l)},[A,A.zoom,A.position.z,y,b,t]),a.useEffect(()=>{D.current&&R(s)},[s,R]),a.useEffect(()=>{D.current&&w(p)},[p,w]),a.useEffect(()=>{async function l(){D.current=!1,Gn(x,I,V),await G(),D.current=!0}l()},[I,V]),a.useEffect(()=>{D.current&&z(v)},[v,z]),a.useEffect(()=>{D.current&&(j.current={},F({}),G())},[e,G,F]),a.useEffect(()=>{D.current&&G(P.current)},[o,n,t,G])},ce=({text:e,fontSize:o,fontUrl:t,color:n,opacity:r,stroke:s,active:i,ellipsis:c})=>{const p=c&&!i?Zt(e,c):e,v=a.useMemo(()=>new re(n),[n]),g=a.useMemo(()=>s?new re(s):void 0,[s]);return O.jsx(it,{position:[0,0,1],children:O.jsx(qt,{font:t,fontSize:o,color:v,fillOpacity:r,textAlign:"center",outlineWidth:s?1:0,outlineColor:g,depthOffset:0,maxWidth:100,overflowWrap:"break-word",children:p})})};ce.defaultProps={opacity:1,fontSize:7,color:"#2A6475",ellipsis:75};const Et=({color:e,id:o,size:t,opacity:n,animated:r})=>{const{scale:s,nodeOpacity:i}=ee({from:{scale:[1e-5,1e-5,1e-5],nodeOpacity:0},to:{scale:[t,t,t],nodeOpacity:n},config:{...te,duration:r?void 0:0}}),c=a.useMemo(()=>new re(e),[e]);return O.jsxs(K.mesh,{userData:{id:o,type:"node"},scale:s,children:[O.jsx("sphereGeometry",{attach:"geometry",args:[1,25,25]}),O.jsx(K.meshPhongMaterial,{attach:"material",side:ne,transparent:!0,fog:!0,opacity:i,color:c})]})};Et.defaultProps={opacity:1,active:!1};const Ct=({color:e,size:o,opacity:t,animated:n,strokeWidth:r})=>{const s=a.useMemo(()=>new re(e),[e]),{ringSize:i,ringOpacity:c}=ee({from:{ringOpacity:0,ringSize:[1e-5,1e-5,1e-5]},to:{ringOpacity:t,ringSize:[o/2,o/2,1]},config:{...te,duration:n?void 0:0}});return O.jsx(it,{position:[0,0,1],children:O.jsxs(K.mesh,{scale:i,children:[O.jsx("ringGeometry",{attach:"geometry",args:[4,4+r,25]}),O.jsx(K.meshBasicMaterial,{attach:"material",color:s,transparent:!0,depthTest:!1,opacity:c,side:ne,fog:!0})]})})};Ct.defaultProps={color:"#D8E6EA",size:1,opacity:.5,strokeWidth:.5};const wt=a.createContext({controls:null,resetControls:()=>{},zoomIn:()=>{},zoomOut:()=>{},panLeft:()=>{},panRight:()=>{},panUp:()=>{},panDown:()=>{}}),Pe=()=>{const e=a.useContext(wt);if(e===void 0)throw new Error("`useCameraControls` hook must be used within a `ControlsProvider` component");return e};q.install({THREE:{MOUSE:Ft,Vector2:ue,Vector3:W,Vector4:Vt,Quaternion:ot,Matrix4:Gt,Spherical:Tt,Box3:nt,Sphere:jt,Raycaster:Pt,MathUtils:{DEG2RAD:(Fe=Re)==null?void 0:Fe.DEG2RAD,clamp:(Be=Re)==null?void 0:Be.clamp}}});Bt({ThreeCameraControls:q});const Ce={ARROW_LEFT:37,ARROW_UP:38,ARROW_RIGHT:39,ARROW_DOWN:40},$e=new Ee(Ce.ARROW_LEFT,100),Ze=new Ee(Ce.ARROW_RIGHT,100),qe=new Ee(Ce.ARROW_UP,100),Qe=new Ee(Ce.ARROW_DOWN,100),_t=a.forwardRef(({mode:e,children:o,animated:t,disabled:n},r)=>{const s=a.useRef(null),i=$(y=>y.camera),c=$(y=>y.gl),p=e==="orbit",v=M(y=>y.setPanning);st((y,R)=>{var w,N;(w=s.current)!=null&&w.enabled&&((N=s.current)==null||N.update(R)),p&&(s.current.azimuthAngle+=20*R*Re.DEG2RAD)},-1),a.useEffect(()=>()=>{var y;return(y=s.current)==null?void 0:y.dispose()},[]);const g=a.useCallback(()=>{var y;(y=s.current)==null||y.zoom(i.zoom/2,t)},[t,i.zoom]),_=a.useCallback(()=>{var y;(y=s.current)==null||y.zoom(-i.zoom/2,t)},[t,i.zoom]),h=a.useCallback(y=>{var R;p||(R=s.current)==null||R.truck(-.03*y.deltaTime,0,t)},[t,p]),E=a.useCallback(y=>{var R;p||(R=s.current)==null||R.truck(.03*y.deltaTime,0,t)},[t,p]),x=a.useCallback(y=>{var R;p||(R=s.current)==null||R.truck(0,.03*y.deltaTime,t)},[t,p]),u=a.useCallback(y=>{var R;p||(R=s.current)==null||R.truck(0,-.03*y.deltaTime,t)},[t,p]),f=a.useCallback(y=>{y.code==="Space"&&(e==="rotate"?s.current.mouseButtons.left=q.ACTION.TRUCK:s.current.mouseButtons.left=q.ACTION.ROTATE)},[e]),d=a.useCallback(y=>{y.code==="Space"&&(e==="rotate"?s.current.mouseButtons.left=q.ACTION.ROTATE:s.current.mouseButtons.left=q.ACTION.TRUCK)},[e]);a.useEffect(()=>(n||($e.addEventListener("holding",E),Ze.addEventListener("holding",h),qe.addEventListener("holding",x),Qe.addEventListener("holding",u),typeof window<"u"&&(window.addEventListener("keydown",f),window.addEventListener("keyup",d))),()=>{$e.removeEventListener("holding",E),Ze.removeEventListener("holding",h),qe.removeEventListener("holding",x),Qe.removeEventListener("holding",u),typeof window<"u"&&(window.removeEventListener("keydown",f),window.removeEventListener("keyup",d))}),[n,f,d,u,E,h,x]),a.useEffect(()=>{n?(s.current.mouseButtons.left=q.ACTION.NONE,s.current.mouseButtons.middle=q.ACTION.NONE,s.current.mouseButtons.wheel=q.ACTION.NONE):(s.current.mouseButtons.left=q.ACTION.TRUCK,s.current.mouseButtons.middle=q.ACTION.TRUCK,s.current.mouseButtons.wheel=q.ACTION.DOLLY)},[n]),a.useEffect(()=>{const y=()=>v(!0),R=()=>v(!1),w=s.current;return w&&(w.addEventListener("control",y),w.addEventListener("controlend",R)),()=>{w&&(w.removeEventListener("control",y),w.removeEventListener("controlend",R))}},[s,v]),a.useEffect(()=>{e==="rotate"?s.current.mouseButtons.left=q.ACTION.ROTATE:s.current.mouseButtons.left=q.ACTION.TRUCK},[e]),Ne([{name:"Zoom In",disabled:n,category:"Graph",keys:"command+shift+i",callback:y=>{y.preventDefault(),g()}},{name:"Zoom Out",category:"Graph",disabled:n,keys:"command+shift+o",callback:y=>{y.preventDefault(),_()}}]);const b=a.useMemo(()=>({controls:s.current,zoomIn:()=>g(),zoomOut:()=>_(),panLeft:(y=100)=>E({deltaTime:y}),panRight:(y=100)=>h({deltaTime:y}),panDown:(y=100)=>u({deltaTime:y}),panUp:(y=100)=>x({deltaTime:y}),resetControls:y=>{var R;return(R=s.current)==null?void 0:R.reset(y)}}),[g,_,E,h,u,x,s.current]);return a.useImperativeHandle(r,()=>b),O.jsxs(wt.Provider,{value:b,children:[O.jsx("threeCameraControls",{ref:s,args:[i,c.domElement],smoothTime:.1,minDistance:1e3,dollyToCursor:!0,maxDistance:5e4}),o]})});_t.defaultProps={mode:"rotate"};function zt(e,o){const t=o.position.z;e<t?e-=t:e+=t;const n=o.fov/o.zoom*Math.PI/180;return 2*Math.tan(n/2)*Math.abs(e)}function qn(e,o){return zt(e,o)*o.aspect}function Qn(e,o){var t,n,r,s;const i=qn(1,e),c=zt(1,e),p={x0:((t=e==null?void 0:e.position)==null?void 0:t.x)-i/2,x1:((n=e==null?void 0:e.position)==null?void 0:n.x)+i/2,y0:((r=e==null?void 0:e.position)==null?void 0:r.y)-c/2,y1:((s=e==null?void 0:e.position)==null?void 0:s.y)+c/2};return(o==null?void 0:o.x)>p.x0&&(o==null?void 0:o.x)<p.x1&&(o==null?void 0:o.y)>p.y0&&(o==null?void 0:o.y)<p.y1}function Je(e,o){return o.reduce((t,n)=>Math.abs(n-e%Math.PI)<Math.abs(t-e%Math.PI)?n:t)}function Jn(e,o){const t=Je(e,[0,Math.PI]),n=Je(o,[Math.PI/2,3*Math.PI/2]);return{horizontalRotation:t-e%Math.PI,verticalRotation:n-o%Math.PI}}const be=50,eo=({animated:e,disabled:o,layoutType:t})=>{const n=M(h=>h.nodes),[r,s]=a.useState(!1),i=$(h=>h.invalidate),{controls:c}=Pe(),p=$(h=>h.camera),v=a.useRef(!1),g=a.useCallback(async(h,E=!0)=>{if(h!=null&&h.some(x=>!Qn(p,x.position))||!v.current){const{minX:x,maxX:u,minY:f,maxY:d,minZ:b,maxZ:y,x:R,y:w,z:N}=Ae(h);if(!t.includes("3d")){const{horizontalRotation:F,verticalRotation:z}=Jn(c==null?void 0:c.azimuthAngle,c==null?void 0:c.polarAngle);c==null||c.rotate(F,z,!0)}await(c==null?void 0:c.fitToBox(new nt(new W(x,f,b),new W(u,d,y)),E,{cover:!1,paddingLeft:be,paddingRight:be,paddingBottom:be,paddingTop:be})),await c.setTarget(R,w,N,E),r||s(!0),i()}},[i,c,e,n]),_=a.useCallback(h=>{let E=null;h!=null&&h.length&&(E=h.reduce((x,u)=>{const f=n.find(d=>d.id===u);if(f)x.push(f);else throw new Error(`Attempted to center ${u} but it was not found in the nodes`);return x},[])),g(E||n)},[g,n]);return a.useLayoutEffect(()=>{async function h(){c&&(n!=null&&n.length)&&(v.current?await g(n,e):(await g(n,!1),v.current=!0))}h()},[c,g,n,e]),Ne([{name:"Center",disabled:o,category:"Graph",keys:["command+shift+c"],callback:()=>g(n)}]),{centerNodes:g,centerNodesById:_,isCentered:r}},kt=({image:e,id:o,size:t,opacity:n,animated:r})=>{const s=a.useMemo(()=>new Xt().load(e),[e]),{scale:i,spriteOpacity:c}=ee({from:{scale:[1e-5,1e-5,1e-5],spriteOpacity:0},to:{scale:[t,t,t],spriteOpacity:n},config:{...te,duration:r?void 0:0}});return O.jsx(K.sprite,{userData:{id:o,type:"node"},scale:i,children:O.jsx(K.spriteMaterial,{attach:"material",opacity:c,fog:!0,depthTest:!1,transparent:!0,side:ne,children:O.jsx("primitive",{attach:"map",object:s,minFilter:$t})})})};kt.defaultProps={opacity:1};const St=({animated:e,disabled:o,id:t,draggable:n,labelFontUrl:r,contextMenu:s,onClick:i,onDoubleClick:c,onPointerOver:p,onDragged:v,onPointerOut:g,onContextMenu:_,renderNode:h})=>{var E,x,u;const f=Pe(),d=M(B=>B.theme),b=M(B=>B.nodes.find(Z=>Z.id===t)),y=M(B=>B.edges),R=M(B=>B.draggingId),w=M(B=>B.collapsedNodeIds),N=M(B=>B.setDraggingId),F=M(B=>B.setNodePosition),z=M(B=>B.setCollapsedNodeIds),D=M(B=>B.collapsedNodeIds.includes(t)),P=M(B=>{var Z;return(Z=B.actives)==null?void 0:Z.includes(t)}),A=M(B=>{var Z;return(Z=B.selections)==null?void 0:Z.includes(t)}),V=M(B=>{var Z;return((Z=B.selections)==null?void 0:Z.length)>0}),I=M(B=>B.centerPosition),j=R===t,{position:G,label:l,subLabel:m,size:C=7,labelVisible:k=!0}=b,S=a.useRef(null),[T,L]=a.useState(!1),[X,H]=a.useState(!1),Q=T||A||P,J=V?Q?d.node.selectedOpacity:d.node.inactiveOpacity:d.node.opacity,oe=a.useMemo(()=>y.filter(Z=>Z.source===t).length>0||D,[y,t,D]),ae=a.useCallback(()=>{oe&&z(D?w.filter(B=>B!==t):[...w,t])},[oe,w,t,D,z]),[{nodePosition:we,labelPosition:ve,subLabelPosition:he}]=ee(()=>({from:{nodePosition:I?[I.x,I.y,0]:[0,0,0],labelPosition:[0,-(C+7),2],subLabelPosition:[0,-(C+14),2]},to:{nodePosition:G?[G.x,G.y,Q?G.z+1:G.z]:[0,0,0],labelPosition:[0,-(C+7),2],subLabelPosition:[0,-(C+14),2]},config:{...te,duration:e&&!R?void 0:0}}),[j,G,e,C,Q]),U=Hn({draggable:n,position:G,set:B=>F(t,B),onDragStart:()=>{N(t),L(!0)},onDragEnd:()=>{N(null),L(!1),v==null||v(b)}});de(T&&!R&&i!==void 0,"pointer"),de(T&&n&&!j&&i===void 0,"grab"),de(j,"grabbing");const Y=Q||j,ie=Y?d.node.activeFill:b.fill||d.node.fill,{pointerOver:_e,pointerOut:le}=De({disabled:o||j,onPointerOver:()=>{f.controls.truckSpeed=0,L(!0),p==null||p(b)},onPointerOut:()=>{f.controls.truckSpeed=2,L(!1),g==null||g(b)}}),me=a.useMemo(()=>h?h({id:t,color:ie,size:C,active:Y,opacity:J,animated:e,node:b}):O.jsx(O.Fragment,{children:b.icon?O.jsx(kt,{id:t,image:b.icon||"",size:C+8,opacity:J,animated:e,color:ie,node:b,active:Y}):O.jsx(Et,{id:t,size:C,opacity:J,animated:e,color:ie,node:b,active:Y})}),[h,t,ie,C,Y,J,e,b]),ze=a.useMemo(()=>{var B,Z,je;return(k||A||T)&&l&&O.jsxs(O.Fragment,{children:[O.jsx(K.group,{position:ve,children:O.jsx(ce,{text:l,fontUrl:r,opacity:J,stroke:d.node.label.stroke,active:A||T||j||P,color:A||T||j||P?d.node.label.activeColor:d.node.label.color})}),m&&O.jsx(K.group,{position:he,children:O.jsx(ce,{text:m,fontUrl:r,fontSize:5,opacity:J,stroke:(B=d.node.subLabel)==null?void 0:B.stroke,active:A||T||j||P,color:A||T||j||P?(Z=d.node.subLabel)==null?void 0:Z.activeColor:(je=d.node.subLabel)==null?void 0:je.color})})]})},[T,P,j,A,l,r,ve,k,J,m,he,d.node.label.activeColor,d.node.label.color,d.node.label.stroke,(E=d.node.subLabel)==null?void 0:E.activeColor,(x=d.node.subLabel)==null?void 0:x.color,(u=d.node.subLabel)==null?void 0:u.stroke]),At=a.useMemo(()=>X&&s&&O.jsx(Le,{prepend:!0,center:!0,children:s({data:b,canCollapse:oe,isCollapsed:D,onCollapse:ae,onClose:()=>H(!1)})}),[X,s,b,oe,D,ae]);return O.jsxs(K.group,{userData:{id:t,type:"node"},ref:S,position:we,onPointerOver:_e,onPointerOut:le,onClick:()=>{!o&&!j&&(i==null||i(b,{canCollapse:oe,isCollapsed:D}))},onDoubleClick:()=>{!o&&!j&&(c==null||c(b))},onContextMenu:()=>{o||(H(!0),_==null||_(b,{canCollapse:oe,isCollapsed:D,onCollapse:ae}))},...U(),children:[me,O.jsx(Ct,{opacity:A?.5:0,size:C,animated:e,color:A||T?d.ring.activeFill:d.ring.fill}),At,ze]})};St.defaultProps={draggable:!1};const Rt=({animated:e,color:o,length:t,opacity:n,position:r,rotation:s,size:i,onActive:c,onContextMenu:p})=>{const v=a.useMemo(()=>new re(o),[o]),g=a.useRef(null),_=M(f=>f.draggingId),h=M(f=>f.centerPosition),[{pos:E,arrowOpacity:x}]=ee(()=>({from:{pos:h?[h.x,h.y,h.z]:[0,0,0],arrowOpacity:0},to:{pos:[r.x,r.y,r.z],arrowOpacity:n},config:{...te,duration:e&&!_?void 0:0}}),[e,_,n,r]),u=a.useCallback(()=>{var f;const d=new W(0,1,0);(f=g.current)==null||f.quaternion.setFromUnitVectors(d,s)},[s,g]);return a.useEffect(()=>u(),[u]),O.jsxs(K.mesh,{position:E,ref:g,scale:[1,1,1],onPointerOver:()=>c(!0),onPointerOut:()=>c(!1),onPointerDown:f=>{f.nativeEvent.buttons===2&&(f.stopPropagation(),p())},children:[O.jsx("cylinderGeometry",{args:[0,i,t,20,1,!0],attach:"geometry"}),O.jsx(K.meshBasicMaterial,{attach:"material",color:v,depthTest:!1,opacity:x,transparent:!0,side:ne,fog:!0})]})};Rt.defaultProps={size:1,opacity:.5,color:"#D8E6EA"};const Ot=({curveOffset:e,animated:o,color:t,curve:n,curved:r=!1,id:s,opacity:i,size:c,onContextMenu:p,onClick:v,onPointerOver:g,onPointerOut:_})=>{const h=a.useRef(null),E=M(b=>b.draggingId),x=a.useMemo(()=>new re(t),[t]),u=M(b=>b.centerPosition),f=a.useRef(!1),{lineOpacity:d}=ee({from:{lineOpacity:0},to:{lineOpacity:i},config:{...te,duration:o?void 0:0}});return ee(()=>{const b=n.getPoint(0),y=n.getPoint(1);return{from:{fromVertices:f.current?[y==null?void 0:y.x,y==null?void 0:y.y,(y==null?void 0:y.z)||0]:[u==null?void 0:u.x,u==null?void 0:u.y,(u==null?void 0:u.z)||0],toVertices:[b==null?void 0:b.x,b==null?void 0:b.y,(b==null?void 0:b.z)||0]},to:{fromVertices:[b==null?void 0:b.x,b==null?void 0:b.y,(b==null?void 0:b.z)||0],toVertices:[y==null?void 0:y.x,y==null?void 0:y.y,(y==null?void 0:y.z)||0]},onChange:R=>{const{fromVertices:w,toVertices:N}=R.value,F=new W(...w),z=new W(...N),D=fe(F,0,z,0,r,e);h.current.copy(new Oe(D,20,c/2,5,!1))},config:{...te,duration:o&&!E?void 0:0}}},[o,E,n,c]),a.useEffect(()=>{f.current=!0},[]),O.jsxs("mesh",{userData:{id:s,type:"edge"},onPointerOver:g,onPointerOut:_,onClick:v,onPointerDown:b=>{b.nativeEvent.buttons===2&&(b.stopPropagation(),p())},children:[O.jsx("tubeGeometry",{attach:"geometry",ref:h}),O.jsx(K.meshBasicMaterial,{attach:"material",opacity:d,fog:!0,transparent:!0,depthTest:!1,color:x})]})};Ot.defaultProps={color:"#000",size:1,opacity:1};const et=3,It=({animated:e,arrowPlacement:o,contextMenu:t,disabled:n,labelPlacement:r,id:s,interpolation:i,labelFontUrl:c,onContextMenu:p,onClick:v,onPointerOver:g,onPointerOut:_})=>{const h=M(U=>U.theme),E=M(U=>U.draggingId),[x,u]=a.useState(!1),[f,d]=a.useState(!1),b=M(U=>U.edges),y=b.find(U=>U.id===s),{target:R,source:w,label:N,labelVisible:F=!1,size:z=1}=y,D=M(U=>U.nodes.find(Y=>Y.id===w)),P=M(U=>U.nodes.find(Y=>Y.id===R)),A=(z+h.edge.label.fontSize)/2,[V,I]=a.useMemo(()=>yt(z),[z]),{curveOffset:j,curved:G}=a.useMemo(()=>Bn({edge:y,edges:b,curved:i==="curved"}),[y,b,i]),[l,m,C]=a.useMemo(()=>{const U=ge(D),Y=D.size,ie=ge(P),_e=P.size;let le=fe(U,Y,ie,_e,G,j);const[me,ze]=mt(o,le,V);return o==="end"&&(le=fe(U,Y,me,0,G,j)),[le,me,ze]},[D,P,G,j,o,V]),k=a.useMemo(()=>{let U=bt(D.position,P.position,ht(A,r));if(G){const Y=new W().subVectors(U,l.getPoint(.5));switch(r){case"above":Y.y=Y.y-et;break;case"below":Y.y=Y.y+et;break}U=U.sub(Y)}return U},[D.position,P.position,A,r,G,l]),S=M(U=>{var Y;return(Y=U.selections)==null?void 0:Y.includes(s)}),T=M(U=>{var Y;return(Y=U.selections)==null?void 0:Y.length}),L=M(U=>{var Y;return(Y=U.actives)==null?void 0:Y.includes(s)}),X=M(U=>U.centerPosition),H=T?S||L?h.edge.selectedOpacity:h.edge.inactiveOpacity:h.edge.opacity,[{labelPosition:Q}]=ee(()=>({from:{labelPosition:X?[X.x,X.y,X.z]:[0,0,0]},to:{labelPosition:[k.x,k.y,k.z]},config:{...te,duration:e&&!E?void 0:0}}),[k,e,E]),J=a.useMemo(()=>new rt(0,0,r==="natural"?0:Math.atan((P.position.y-D.position.y)/(P.position.x-D.position.x))),[P.position.x,P.position.y,D.position.x,D.position.y,r]);de(x&&!E&&v!==void 0,"pointer");const{pointerOver:oe,pointerOut:ae}=De({disabled:n,onPointerOver:()=>{u(!0),g==null||g(y)},onPointerOut:()=>{u(!1),_==null||_(y)}}),we=a.useMemo(()=>o!=="none"&&O.jsx(Rt,{animated:e,color:S||x||L?h.arrow.activeFill:h.arrow.fill,length:V,opacity:H,position:m,rotation:C,size:I,onActive:u,onContextMenu:()=>{n||(d(!0),p==null||p(y))}}),[x,e,V,o,m,C,I,n,y,L,S,p,H,h.arrow.activeFill,h.arrow.fill]),ve=a.useMemo(()=>F&&N&&O.jsx(K.group,{position:Q,rotation:J,children:O.jsx(ce,{text:N,ellipsis:15,fontUrl:c,stroke:h.edge.label.stroke,color:S||x||L?h.edge.label.activeColor:h.edge.label.color,opacity:H,fontSize:h.edge.label.fontSize})}),[x,L,S,N,c,Q,J,F,H,h.edge.label.activeColor,h.edge.label.color,h.edge.label.fontSize,h.edge.label.stroke]),he=a.useMemo(()=>f&&t&&O.jsx(Le,{prepend:!0,center:!0,children:t({data:y,onClose:()=>d(!1)})}),[f,t,y]);return O.jsxs("group",{children:[O.jsx(Ot,{curveOffset:j,animated:e,color:S||x||L?h.edge.activeFill:h.edge.fill,curve:l,curved:G,id:s,opacity:H,size:z,onClick:()=>{n||v==null||v(y)},onPointerOver:oe,onPointerOut:ae,onContextMenu:()=>{n||(d(!0),p==null||p(y))}}),we,ve,he]})};It.defaultProps={labelPlacement:"inline",arrowPlacement:"end"};const tt=new Ut(0,0,0);function to(e,o){const t=a.useRef(),n=M(p=>p.theme);M(p=>{t.current=p});const r=a.useRef(new Map),s=o==="curved",i=a.useCallback(p=>{const v=[],g=r.current,{nodes:_}=t.current;return p.forEach(h=>{const{target:E,source:x,size:u=1}=h,f=_.find(l=>l.id===x),d=_.find(l=>l.id===E);if(!f||!d)return;const b=`fromX:${f.position.x},fromY:${f.position.y},toX:${d.position.x}},toY:${d.position.y}`;if(g.has(b)){const l=g.get(b);v.push(l);return}const y=ge(f),R=f.size+n.edge.label.fontSize,w=ge(d),N=d.size+n.edge.label.fontSize;let F=fe(y,R,w,N,s),z=new Oe(F,20,u/2,5,!1);if(e==="none"){v.push(z),g.set(b,z);return}const[D,P]=yt(u),[A,V]=mt(e,F,D),I=new ot;I.setFromUnitVectors(new W(0,1,0),V);const j=new en(0,P,D,20,1,!0);if(j.applyQuaternion(I),j.translate(A.x,A.y,A.z),e&&e==="end"){const l=fe(y,R,A,0,s);z=new Oe(l,20,u/2,5,!1)}const G=ye([z,j]);v.push(G),g.set(b,G)}),v},[e,s,n.edge.label.fontSize]),c=a.useCallback((p,v)=>{const g=i(p),_=i(v);return ye([_.length?ye(_):tt,g.length?ye(g):tt],!0)},[i]);return{getGeometries:i,getGeometry:c}}function no(e,o,t){const{onClick:n,onContextMenu:r,onPointerOut:s,onPointerOver:i}=e,c=M(x=>x.edgeContextMenus),p=M(x=>x.setEdgeContextMenus),v=a.useRef(!1),g=a.useCallback(()=>{v.current=!0},[]),_=a.useRef(!1),h=a.useCallback(()=>{_.current=!0},[]),E=a.useCallback((x,u)=>{n&&v.current&&(v.current=!1,t||u.forEach(f=>{n(f)})),(o||r)&&_.current&&(_.current=!1,t||u.forEach(f=>{c.has(f.id)||(p(new Set([...c,f.id])),r==null||r(f))})),i&&u.filter(d=>!x.includes(d)).forEach(d=>{i(d)}),s&&x.filter(d=>!u.includes(d)).forEach(d=>{s(d)})},[o,t,c,p,n,r,i,s]);return{handleClick:g,handleContextMenu:h,handleIntersections:E}}function oo(e,o){const t=a.useRef(e);a.useEffect(()=>{t.current=e},[e]);const n=a.useCallback(()=>{const s=t.current.getAttribute("position"),i=Array.from({length:s.array.length}).fill(0),c=Array.from(s.array);return{from:i,to:c}},[]),r=a.useCallback(s=>{const i=new Float32Array(s),c=new tn(i,3,!1);t.current.setAttribute("position",c),c.needsUpdate=!0},[]);ee(()=>{if(!o)return null;const s=n();return{from:{positions:s.from},to:{positions:s.to},onChange:i=>{r(i.value.positions)},config:{...te,duration:o?void 0:0}}},[o])}function so(e,o,t){const[{activeOpacity:n,inactiveOpacity:r}]=ee(()=>({from:{activeOpacity:0,inactiveOpacity:0},to:{activeOpacity:o?t.edge.selectedOpacity:t.edge.opacity,inactiveOpacity:o?t.edge.inactiveOpacity:t.edge.opacity},config:{...te,duration:e?void 0:0}}),[e,o,t]);return{activeOpacity:n,inactiveOpacity:r}}const Mt=({animated:e,color:o,contextMenu:t,edge:n,labelFontUrl:r,labelPlacement:s,opacity:i})=>{const c=M(z=>z.theme),{target:p,source:v,label:g,labelVisible:_=!1,size:h=1}=n,E=M(z=>z.nodes),x=E.find(z=>z.id===v),u=E.find(z=>z.id===p),f=M(z=>z.draggingId),d=(h+c.edge.label.fontSize)/2,b=a.useMemo(()=>bt(x.position,u.position,ht(d,s)),[x.position,u.position,d,s]),y=M(z=>z.edgeContextMenus),R=M(z=>z.setEdgeContextMenus),[{labelPosition:w}]=ee(()=>({from:{labelPosition:[0,0,0]},to:{labelPosition:[b.x,b.y,b.z]},config:{...te,duration:e&&!f?void 0:0}}),[b,e,f]),N=a.useCallback(z=>{y.delete(z.id),R(new Set(y.values()))},[y,R]),F=a.useMemo(()=>new rt(0,0,s==="natural"?0:Math.atan((u.position.y-x.position.y)/(u.position.x-x.position.x))),[u.position.x,u.position.y,x.position.x,x.position.y,s]);return O.jsxs("group",{children:[_&&g&&O.jsx(K.group,{position:w,rotation:F,children:O.jsx(ce,{text:g,ellipsis:15,fontUrl:r,stroke:c.edge.label.stroke,color:o,opacity:i,fontSize:c.edge.label.fontSize})}),t&&y.has(n.id)&&O.jsx(Le,{prepend:!0,center:!0,position:b,children:t({data:n,onClose:()=>N(n)})})]})};Mt.defaultProps={labelPlacement:"inline"};const ro=({interpolation:e="linear",arrowPlacement:o="end",labelPlacement:t="inline",animated:n,contextMenu:r,disabled:s,edges:i,labelFontUrl:c,onClick:p,onContextMenu:v,onPointerOut:g,onPointerOver:_})=>{const h=M(S=>S.theme),{getGeometries:E,getGeometry:x}=to(o,e),u=M(S=>S.draggingId),f=M(S=>S.edgeMeshes),d=M(S=>S.setEdgeMeshes),b=M(S=>S.actives||[]),y=M(S=>S.selections||[]),[R,w,N,F]=a.useMemo(()=>{const S=[],T=[],L=[],X=[];return i.forEach(H=>{if(u===H.source||u===H.target){y.includes(H.id)||b.includes(H.id)?L.push(H):X.push(H);return}y.includes(H.id)||b.includes(H.id)?S.push(H):T.push(H)}),[S,T,L,X]},[i,b,y,u]),z=!!y.length,D=a.useMemo(()=>x(R,w),[x,R,w]),{activeOpacity:P,inactiveOpacity:A}=so(n,z,h);oo(D,n),a.useEffect(()=>{if(u===null){const T=E(i).map(L=>new ke(L));d(T)}},[E,d,i,u]);const V=a.useRef(new ke),I=a.useRef(new ke),j=a.useCallback(S=>{if(!S.camera)return[];const T=S.intersectObjects(f);return T.length?T.map(L=>i[f.indexOf(L.object)]):[]},[f,i]),{handleClick:G,handleContextMenu:l,handleIntersections:m}=no({onClick:p,onContextMenu:v,onPointerOut:g,onPointerOver:_},r,s),C=a.useRef(null),k=a.useRef([]);return st(S=>{if(V.current.geometry=D,s)return;const T=C.current;if((u||u===null&&T!==null)&&(I.current.geometry=x(N,F)),C.current=u,u)return;const L=k.current,X=j(S.raycaster);m(L,X),X.join()!==L.join()&&(I.current.geometry=x(X,[])),k.current=X}),O.jsxs("group",{onClick:G,onContextMenu:l,children:[O.jsxs("mesh",{ref:V,children:[O.jsx(K.meshBasicMaterial,{attach:"material-0",color:h.edge.fill,depthTest:!1,fog:!0,opacity:A,side:ne,transparent:!0}),O.jsx(K.meshBasicMaterial,{attach:"material-1",color:h.edge.activeFill,depthTest:!1,fog:!0,opacity:P,side:ne,transparent:!0})]}),O.jsxs("mesh",{ref:I,children:[O.jsx(K.meshBasicMaterial,{attach:"material-0",color:h.edge.fill,depthTest:!1,fog:!0,opacity:A,side:ne,transparent:!0}),O.jsx(K.meshBasicMaterial,{attach:"material-1",color:h.edge.activeFill,depthTest:!1,fog:!0,opacity:P,side:ne,transparent:!0})]}),i.map(S=>O.jsx(Mt,{animated:n,contextMenu:r,color:h.edge.label.color,disabled:s,edge:S,labelFontUrl:c,labelPlacement:t},S.id))]})},Nt=({animated:e,position:o,padding:t,labelFontUrl:n,disabled:r,radius:s,nodes:i,label:c,onClick:p,onPointerOver:v,onPointerOut:g})=>{var _,h,E,x,u;const f=M(C=>C.theme),d=Math.max(o.width,o.height)/2,b=d-s+t,[y,R]=a.useState(!1),w=M(C=>C.centerPosition),N=M(C=>{var k;return(k=C.actives)==null?void 0:k.some(S=>i.some(T=>T.id===S))}),F=M(C=>{var k;return(k=C.selections)==null?void 0:k.some(S=>i.some(T=>T.id===S))}),D=M(C=>{var k;return((k=C.selections)==null?void 0:k.length)>0})?F||y||N?(_=f.cluster)==null?void 0:_.selectedOpacity:(h=f.cluster)==null?void 0:h.inactiveOpacity:(E=f.cluster)==null?void 0:E.opacity,{circleOpacity:P,circlePosition:A,labelPosition:V}=ee({from:{circlePosition:[w.x,w.y,-1],circleOpacity:0,labelPosition:[0,-b,2]},to:{labelPosition:[0,-b,2],circlePosition:o?[o.x,o.y,-1]:[0,0,-1],circleOpacity:D},config:{...te,duration:e?void 0:0}}),I=a.useMemo(()=>{var C;return new re((C=f.cluster)==null?void 0:C.stroke)},[(x=f.cluster)==null?void 0:x.stroke]),j=a.useMemo(()=>{var C;return new re((C=f.cluster)==null?void 0:C.fill)},[(u=f.cluster)==null?void 0:u.fill]);de(y&&p!==void 0,"pointer");const{pointerOver:G,pointerOut:l}=De({disabled:r,onPointerOver:()=>{R(!0),v==null||v({nodes:i,label:c})},onPointerOut:()=>{R(!1),g==null||g({nodes:i,label:c})}});return a.useMemo(()=>{var C,k,S;return f.cluster&&O.jsxs(K.group,{position:A,onPointerOver:G,onPointerOut:l,onClick:()=>{r||p==null||p({nodes:i,label:c})},children:[O.jsxs("mesh",{children:[O.jsx("ringGeometry",{attach:"geometry",args:[b,0,128]}),O.jsx(K.meshBasicMaterial,{attach:"material",color:j,transparent:!0,depthTest:!1,opacity:(C=f.cluster)!=null&&C.fill?P:0,side:ne,fog:!0})]}),O.jsxs("mesh",{children:[O.jsx("ringGeometry",{attach:"geometry",args:[b,d+t,128]}),O.jsx(K.meshBasicMaterial,{attach:"material",color:I,transparent:!0,depthTest:!1,opacity:P,side:ne,fog:!0})]}),((k=f.cluster)==null?void 0:k.label)&&O.jsx(K.group,{position:V,children:O.jsx(ce,{text:c,opacity:D,fontUrl:n,stroke:f.cluster.label.stroke,active:!1,color:(S=f.cluster)==null?void 0:S.label.color,fontSize:12})})]})},[f.cluster,A,G,l,b,j,P,d,t,I,V,c,D,n,r,p,i])};Nt.defaultProps={radius:2,padding:40};const Lt=a.forwardRef(({onNodeClick:e,onNodeDoubleClick:o,onNodeContextMenu:t,onEdgeContextMenu:n,onEdgeClick:r,onEdgePointerOver:s,onEdgePointerOut:i,onNodePointerOver:c,onNodePointerOut:p,onClusterClick:v,onNodeDragged:g,onClusterPointerOver:_,onClusterPointerOut:h,contextMenu:E,animated:x,disabled:u,draggable:f,edgeLabelPosition:d,edgeArrowPosition:b,edgeInterpolation:y,labelFontUrl:R,renderNode:w,...N},F)=>{const{layoutType:z,clusterAttribute:D}=N,P=$(L=>L.gl),A=$(L=>L.scene),V=$(L=>L.camera);if(Zn(N),D&&!(z==="forceDirected2d"||z==="forceDirected3d"))throw new Error("Clustering is only supported for the force directed layouts.");const I=M(L=>L.graph),j=M(L=>L.nodes),G=M(L=>L.edges),l=M(L=>[...L.clusters.values()]),{centerNodesById:m,isCentered:C}=eo({animated:x,disabled:u,layoutType:z});a.useImperativeHandle(F,()=>({centerGraph:m,graph:I,renderScene:()=>P.render(A,V)}),[m,I,P,A,V]);const k=a.useMemo(()=>j.map(L=>O.jsx(St,{id:L==null?void 0:L.id,labelFontUrl:R,draggable:f,disabled:u,animated:x,contextMenu:E,renderNode:w,onClick:e,onDoubleClick:o,onContextMenu:t,onPointerOver:c,onPointerOut:p,onDragged:g},L==null?void 0:L.id)),[x,E,u,f,R,j,e,t,o,g,p,c,w]),S=a.useMemo(()=>x?G.map(L=>O.jsx(It,{id:L.id,disabled:u,animated:x,labelFontUrl:R,labelPlacement:d,arrowPlacement:b,interpolation:y,contextMenu:E,onClick:r,onContextMenu:n,onPointerOver:s,onPointerOut:i},L.id)):O.jsx(ro,{edges:G,disabled:u,animated:x,labelFontUrl:R,labelPlacement:d,arrowPlacement:b,interpolation:y,contextMenu:E,onClick:r,onContextMenu:n,onPointerOver:s,onPointerOut:i}),[x,E,u,b,y,d,G,R,r,n,i,s]),T=a.useMemo(()=>l.map(L=>O.jsx(Nt,{animated:x,disabled:u,labelFontUrl:R,onClick:v,onPointerOver:_,onPointerOut:h,...L},L.label)),[x,l,u,R,v,h,_]);return C&&O.jsxs(a.Fragment,{children:[k,S,T]})});Lt.defaultProps={edgeInterpolation:"linear"};const io={canvas:{background:"#fff"},node:{fill:"#7CA0AB",activeFill:"#1DE9AC",opacity:1,selectedOpacity:1,inactiveOpacity:.2,label:{color:"#2A6475",stroke:"#fff",activeColor:"#1DE9AC"},subLabel:{color:"#ddd",stroke:"transparent",activeColor:"#1DE9AC"}},lasso:{border:"1px solid #55aaff",background:"rgba(75, 160, 255, 0.1)"},ring:{fill:"#D8E6EA",activeFill:"#1DE9AC"},edge:{fill:"#D8E6EA",activeFill:"#1DE9AC",opacity:1,selectedOpacity:1,inactiveOpacity:.1,label:{stroke:"#fff",color:"#2A6475",activeColor:"#1DE9AC",fontSize:6}},arrow:{fill:"#D8E6EA",activeFill:"#1DE9AC"},cluster:{stroke:"#D8E6EA",opacity:1,selectedOpacity:1,inactiveOpacity:.1,label:{stroke:"#fff",color:"#2A6475"}}};function Se(e,o,t){o=Array.isArray(o)?o:[o];const n=[],r=[];for(const s of o){const i=[...e.inEdgeEntries(s)??[],...e.outEdgeEntries(s)??[]];if(i)for(const c of i){const p=c.attributes.id;if(t==="in"?c.target===s&&!r.includes(p)&&r.push(p):t==="out"?c.source===s&&!r.includes(p)&&r.push(p):r.includes(p)||r.push(p),t==="out"||t==="all"){const v=c.target;n.includes(v)||n.push(v)}(t==="in"||t==="all")&&(n.includes(c.source)||n.push(c.source))}}return{nodes:n,edges:r}}function xe(e,o,t){const{offsetX:n,offsetY:r}=e,{width:s,height:i}=t;o.set(n/s*2-1,-(r/i)*2+1)}function co(e){const o=document.createElement("div");return o.style.pointerEvents="none",o.style.border=e.lasso.border,o.style.backgroundColor=e.lasso.background,o.style.position="fixed",o}const ao=({children:e,type:o="none",onLasso:t,onLassoEnd:n,disabled:r})=>{var s;const i=M(I=>I.theme),c=$(I=>I.camera),p=$(I=>I.gl),v=$(I=>I.setEvents),g=$(I=>I.size),_=$(I=>I.get),h=$(I=>I.scene),E=Pe(),x=M(I=>I.actives),u=M(I=>I.setActives),f=M(I=>I.edges),d=M(I=>I.edgeMeshes),b=a.useRef(!1),y=a.useRef(null),R=a.useRef(null),w=a.useRef(co(i)),N=a.useRef(null),F=a.useRef(!1),z=a.useRef(_().events.enabled),D=a.useRef((s=E.controls)==null?void 0:s.enabled);a.useEffect(()=>{b.current&&(t==null||t(x)),b.current=!0},[x,t]);const P=a.useCallback(I=>{if(F.current){const[j,G,l]=N.current;l.x=Math.max(j.x,I.clientX),l.y=Math.max(j.y,I.clientY),G.x=Math.min(j.x,I.clientX),G.y=Math.min(j.y,I.clientY),w.current.style.left=`${G.x}px`,w.current.style.top=`${G.y}px`,w.current.style.width=`${l.x-G.x}px`,w.current.style.height=`${l.y-G.y}px`,xe(I,y.current.endPoint,g),xe(I,R.current.endPoint,g);const m=[],C=R.current.select().sort(S=>S.uuid).map(S=>f[d.indexOf(S)].id);m.push(...C);const k=y.current.select().sort(S=>S.uuid).filter(S=>{var T,L;return S.isMesh&&((T=S.userData)==null?void 0:T.id)&&(((L=S.userData)==null?void 0:L.type)===o||o==="all")}).map(S=>S.userData.id);m.push(...k),requestAnimationFrame(()=>{u(m)}),document.addEventListener("pointermove",P,{passive:!0,capture:!0,once:!0})}},[f,d,u,g,o]),A=a.useCallback(()=>{var I;F.current&&(v({enabled:z.current}),F.current=!1,(I=w.current.parentElement)==null||I.removeChild(w.current),E.controls.enabled=D.current,n==null||n(x),document.removeEventListener("pointermove",P),document.removeEventListener("pointerup",A))},[v,E.controls,n,x,P]),V=a.useCallback(I=>{var j,G;if(I.shiftKey){z.current=_().events.enabled,D.current=(j=E.controls)==null?void 0:j.enabled,y.current=new Te(c,h);const l=new Ht;d.length&&l.add(...d),R.current=new Te(c,l),N.current=[new ue,new ue,new ue];const[m]=N.current;E.controls.enabled=!1,v({enabled:!1}),F.current=!0,(G=p.domElement.parentElement)==null||G.appendChild(w.current),w.current.style.left=`${I.clientX}px`,w.current.style.top=`${I.clientY}px`,w.current.style.width="0px",w.current.style.height="0px",m.x=I.clientX,m.y=I.clientY,xe(I,y.current.startPoint,g),xe(I,R.current.startPoint,g),document.addEventListener("pointermove",P,{passive:!0,capture:!0,once:!0}),document.addEventListener("pointerup",A,{passive:!0})}},[c,E.controls,d,_,p.domElement.parentElement,P,A,h,v,g]);return a.useEffect(()=>{if(!(r||o==="none"))return typeof window<"u"&&(document.addEventListener("pointerdown",V,{passive:!0}),document.addEventListener("pointermove",P,{passive:!0}),document.addEventListener("pointerup",A,{passive:!0})),()=>{typeof window<"u"&&(document.removeEventListener("pointerdown",V),document.removeEventListener("pointermove",P),document.removeEventListener("pointerup",A))}},[o,r,V,P,A]),O.jsx("group",{children:e})},ho=({selections:e=[],nodes:o=[],actives:t=[],focusOnSelect:n=!0,type:r="single",pathHoverType:s="out",pathSelectionType:i="direct",ref:c,hotkeys:p=["selectAll","deselect","delete"],disabled:v,onSelection:g})=>{const[_,h]=a.useState([]),[E,x]=a.useState(t),[u,f]=a.useState(e),[d,b]=a.useState(!1),y=r==="multi"||r==="multiModifier",R=a.useCallback(m=>{if(!v&&m){m=Array.isArray(m)?m:[m];const C=m.filter(k=>!u.includes(k));if(C.length){const k=[...u,...C];g==null||g(k),f(k)}}},[v,u,g]),w=a.useCallback(m=>{if(!v&&m){m=Array.isArray(m)?m:[m];const C=u.filter(k=>!m.includes(k));g==null||g(C),f(C)}},[v,u,g]),N=a.useCallback((m=[])=>{v||(m=Array.isArray(m)?m:[m],x([]),f(m),g==null||g(m))},[v,g]),F=a.useCallback(m=>{u.includes(m)?w(m):y?R(m):N(m)},[R,N,u,y,w]),z=a.useCallback(m=>{var C;if(y?r==="multiModifier"?d?R(m.id):N(m.id):R(m.id):N(m.id),n===!0||n==="singleOnly"&&!d){if(!c.current)throw new Error("No ref found for the graph canvas.");const k=c.current.getGraph(),{nodes:S}=Se(k,[m.id],i);(C=c.current)==null||C.centerGraph([m.id,...S])}},[R,N,n,y,d,i,c,r]),D=a.useCallback((m,C)=>{const k=c.current.getGraph();if(!k)throw new Error("Graph is not initialized");const S=Kn(k,m,C);N([m,C]);const T=[];for(let L=0;L<S.length-1;L++){const X=S[L],H=S[L+1],Q=k.getEdgeAttributes(X,H);Q&&T.push(Q.id)}x([...S.map(L=>L),...T])},[N,c]),P=a.useCallback(m=>{const C=m.target,k=C.tagName!=="INPUT"&&C.tagName!=="SELECT"&&C.tagName!=="TEXTAREA"&&!C.isContentEditable,S=m.metaKey||m.ctrlKey;k&&S&&(m.preventDefault(),b(!0))},[]);a.useEffect(()=>(typeof window<"u"&&window.addEventListener("keydown",P),()=>{typeof window<"u"&&window.removeEventListener("keydown",P)}),[P]);const A=a.useCallback(m=>{var C;if(m.button!==2&&(u.length||E.length)&&(N(),b(!1),n&&u.length===1)){if(!c.current)throw new Error("No ref found for the graph canvas.");(C=c.current)==null||C.centerGraph()}},[N,n,E.length,u.length,c]),V=a.useCallback(m=>{x(m)},[]),I=a.useCallback(m=>{N(m)},[N]),j=a.useCallback(m=>{if(s){const C=c.current.getGraph();if(!C)throw new Error("No ref found for the graph canvas.");const{nodes:k,edges:S}=Se(C,[m.id],s);h([...k,...S])}},[s,c]),G=a.useCallback(()=>{s&&h([])},[s]);return a.useEffect(()=>{var m;if(i!=="direct"&&u.length>0){const C=(m=c.current)==null?void 0:m.getGraph();if(C){const{nodes:k,edges:S}=Se(C,u,i);x([...k,...S])}}},[u,i,c]),Ne([{name:"Select All",keys:"mod+a",disabled:!p.includes("selectAll"),category:"Graph",description:"Select all nodes and edges",callback:m=>{if(m.preventDefault(),!v&&r!=="single"){const C=o.map(k=>k.id);g==null||g(C),f(C)}}},{name:"Deselect Selections",category:"Graph",disabled:!p.includes("deselect"),description:"Deselect selected nodes and edges",keys:"escape",callback:m=>{v||(m.preventDefault(),g==null||g([]),f([]))}}]),{actives:a.useMemo(()=>[...E,..._],[E,_]),onNodeClick:z,onNodePointerOver:j,onNodePointerOut:G,onLasso:V,onLassoEnd:I,selectNodePaths:D,onCanvasClick:A,selections:u,clearSelections:N,addSelection:R,removeSelection:w,toggleSelection:F,setSelections:f}},lo="_canvas_670zp_1",uo={canvas:lo},fo={alpha:!0,antialias:!0},go={position:[0,0,1e3],near:5,far:5e4,fov:10},po=a.forwardRef(({cameraMode:e,edges:o,children:t,nodes:n,theme:r,onCanvasClick:s,animated:i,disabled:c,lassoType:p,onLasso:v,onLassoEnd:g,glOptions:_,...h},E)=>{var x,u;const f=a.useRef(null),d=a.useRef(null),b=a.useRef(null);a.useImperativeHandle(E,()=>({centerGraph:z=>{var D;return(D=f.current)==null?void 0:D.centerGraph(z)},zoomIn:()=>{var z;return(z=d.current)==null?void 0:z.zoomIn()},zoomOut:()=>{var z;return(z=d.current)==null?void 0:z.zoomOut()},panLeft:()=>{var z;return(z=d.current)==null?void 0:z.panLeft()},panRight:()=>{var z;return(z=d.current)==null?void 0:z.panRight()},panDown:()=>{var z;return(z=d.current)==null?void 0:z.panDown()},panUp:()=>{var z;return(z=d.current)==null?void 0:z.panUp()},resetControls:z=>{var D;return(D=d.current)==null?void 0:D.resetControls(z)},getControls:()=>{var z;return(z=d.current)==null?void 0:z.controls},getGraph:()=>{var z;return(z=f.current)==null?void 0:z.graph},exportCanvas:()=>(f.current.renderScene(),b.current.toDataURL())}));const{selections:y,actives:R,collapsedNodeIds:w}=h,N=o.length+n.length>400?!1:i,F=a.useMemo(()=>({..._,...fo}),[_]);return O.jsx("div",{className:uo.canvas,children:O.jsx(Yt,{legacy:!0,linear:!0,ref:b,flat:!0,gl:F,camera:go,onPointerMissed:s,children:O.jsxs(Wn,{createStore:()=>Xn({selections:y,actives:R,theme:r,collapsedNodeIds:w}),children:[((x=r.canvas)==null?void 0:x.background)&&O.jsx("color",{attach:"background",args:[r.canvas.background]}),O.jsx("ambientLight",{intensity:1}),t,((u=r.canvas)==null?void 0:u.fog)&&O.jsx("fog",{attach:"fog",args:[r.canvas.fog,4e3,9e3]}),O.jsx(_t,{mode:e,ref:d,disabled:c,animated:i,children:O.jsx(ao,{disabled:c,type:p,onLasso:v,onLassoEnd:g,children:O.jsx(a.Suspense,{children:O.jsx(Lt,{ref:f,disabled:c,animated:N,edges:o,nodes:n,...h})})})})]})})})});po.defaultProps={cameraMode:"pan",layoutType:"forceDirected2d",sizingType:"default",labelType:"auto",theme:io,animated:!0,defaultNodeSize:7,minNodeSize:5,maxNodeSize:15,lassoType:"none",glOptions:{}};export{po as G,kt as I,ho as u};
